<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>AjayaDesign â€” Admin Dashboard</title>
  <meta name="robots" content="noindex, nofollow">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            mono: ['JetBrains Mono', 'monospace'],
            sans: ['Inter', 'sans-serif'],
          },
          colors: {
            'surface':     '#06060A',
            'surface-1':   '#0C0C12',
            'surface-2':   '#12121A',
            'surface-3':   '#1A1A24',
            'border':      '#2A2A3A',
            'border-glow': '#3A3A5A',
            'amd-red':     '#ED1C24',
            'brand-btn':   '#991B1B',
            'brand-link':  '#FF6B6B',
            'electric':    '#00D4FF',
            'electric-dim':'#0099BB',
            'neon-green':  '#00FF88',
            'neon-yellow': '#FFD600',
            'neon-orange': '#FF8A00',
            'neon-purple': '#A855F7',
          },
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'glow': 'glow 2s ease-in-out infinite alternate',
            'slide-up': 'slideUp 0.3s ease-out',
            'fade-in': 'fadeIn 0.4s ease-out',
          },
          keyframes: {
            glow: {
              '0%': { boxShadow: '0 0 5px rgba(0,212,255,0.2)' },
              '100%': { boxShadow: '0 0 20px rgba(0,212,255,0.4)' },
            },
            slideUp: {
              '0%': { opacity: '0', transform: 'translateY(10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
          },
        }
      }
    }
  </script>
  <style>
    /* Custom scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: #0C0C12; }
    ::-webkit-scrollbar-thumb { background: #2A2A3A; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #3A3A5A; }

    /* Terminal log styles */
    .log-line { font-size: 0.8rem; line-height: 1.6; }
    .log-line:hover { background: rgba(255,255,255,0.03); }
    .log-step { color: #00D4FF; font-weight: 600; }
    .log-ai { color: #A855F7; }
    .log-test-pass { color: #00FF88; }
    .log-test-fail { color: #FF6B6B; }
    .log-deploy { color: #FFD600; }
    .log-error { color: #FF6B6B; opacity: 0.9; }
    .log-dim { opacity: 0.5; }

    /* Step progress */
    .step-dot { transition: all 0.3s ease; }
    .step-dot.active { box-shadow: 0 0 12px rgba(0,212,255,0.6); }
    .step-dot.done { box-shadow: 0 0 8px rgba(0,255,136,0.4); }
    .step-connector { transition: background 0.5s ease; }

    /* AI chat bubbles */
    .ai-bubble { animation: slideUp 0.3s ease-out; }

    /* Glass effect */
    .glass { background: rgba(12,12,18,0.8); backdrop-filter: blur(12px); }

    /* Sidebar item hover */
    .build-item { transition: all 0.15s ease; }
    .build-item:hover { background: rgba(255,255,255,0.04); }
    .build-item.selected { background: rgba(0,212,255,0.08); border-color: #00D4FF; }

    /* Hide scrollbar for sidebar on mobile */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* Pulsing dot for active builds */
    @keyframes live-pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.5); }
    }
    .live-dot { animation: live-pulse 1.5s ease-in-out infinite; }

    /* â•â•â• Pipeline Graph Styles â•â•â• */
    .pipeline-container { position: relative; }

    .pipe-node {
      position: relative;
      padding: 0.75rem 1rem;
      border-radius: 0.75rem;
      border: 1px solid #2A2A3A;
      background: #0C0C12;
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      animation: fadeIn 0.4s ease-out;
    }
    .pipe-node.pending { opacity: 0.3; border-color: #1A1A24; }
    .pipe-node.active {
      border-color: #00D4FF;
      box-shadow: 0 0 20px rgba(0,212,255,0.15), inset 0 0 20px rgba(0,212,255,0.03);
    }
    .pipe-node.done {
      border-color: rgba(0,255,136,0.3);
      background: rgba(0,255,136,0.03);
    }
    .pipe-node.failed {
      border-color: rgba(255,107,107,0.4);
      background: rgba(255,107,107,0.03);
    }

    /* Vertical connector lines */
    .pipe-connector {
      width: 2px;
      margin: 0 auto;
      background: #1A1A24;
      transition: background 0.5s ease;
    }
    .pipe-connector.lit { background: linear-gradient(180deg, rgba(0,255,136,0.5), rgba(0,212,255,0.3)); }
    .pipe-connector.lit-fail { background: linear-gradient(180deg, rgba(255,107,107,0.4), rgba(255,107,107,0.2)); }

    /* Fork/join connectors */
    .pipe-fork {
      position: relative;
      display: flex;
      justify-content: center;
    }
    .pipe-fork::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 2px;
      height: 12px;
      background: inherit;
    }
    .pipe-fork-line {
      position: absolute;
      top: 12px;
      height: 2px;
      background: #1A1A24;
      transition: background 0.5s ease;
    }
    .pipe-fork-line.lit { background: rgba(0,212,255,0.3); }

    /* Branch drop lines */
    .pipe-branch-drop {
      width: 2px;
      height: 12px;
      margin: 0 auto;
      background: #1A1A24;
      transition: background 0.5s ease;
    }
    .pipe-branch-drop.lit { background: rgba(0,212,255,0.3); }

    /* Pulse animation for active nodes */
    @keyframes node-pulse {
      0%, 100% { box-shadow: 0 0 20px rgba(0,212,255,0.15); }
      50% { box-shadow: 0 0 30px rgba(0,212,255,0.3); }
    }
    .pipe-node.active { animation: node-pulse 2s ease-in-out infinite; }

    /* Agent grid cards */
    .agent-card {
      border-radius: 0.5rem;
      border: 1px solid #2A2A3A;
      background: #12121A;
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
      transition: all 0.3s ease;
    }
    .agent-card.pending { opacity: 0.25; }
    .agent-card.active { border-color: #00D4FF; box-shadow: 0 0 12px rgba(0,212,255,0.1); }
    .agent-card.done { border-color: rgba(0,255,136,0.3); }
    .agent-card.failed { border-color: rgba(255,107,107,0.3); }

    /* Council debate bubbles */
    .council-bubble {
      border-radius: 0.75rem;
      padding: 0.6rem 0.8rem;
      font-size: 0.75rem;
      animation: slideUp 0.3s ease-out;
    }
    .council-bubble.strategist { background: rgba(0,212,255,0.08); border-left: 3px solid #00D4FF; }
    .council-bubble.critic { background: rgba(168,85,247,0.08); border-left: 3px solid #A855F7; }

    /* Retry pulse */
    @keyframes retry-shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-2px); }
      40% { transform: translateX(2px); }
      60% { transform: translateX(-1px); }
      80% { transform: translateX(1px); }
    }
    .retry-shake { animation: retry-shake 0.4s ease-in-out; }

    /* Prevent scroll chaining to body on mobile */
    .scroll-contain { overscroll-behavior-y: contain; -webkit-overflow-scrolling: touch; }
    /* Safe area for iPhones with home indicator */
    #mobile-tab-bar { padding-bottom: env(safe-area-inset-bottom, 0); }
    /* Mobile sidebar */
    @media (max-width: 767px) {
      #sidebar.translate-x-0 { box-shadow: 4px 0 25px rgba(0,0,0,0.6); }
      /* sidebar ends above bottom tab bar */
      #sidebar { bottom: 3rem; }
    }
  </style>
</head>
<body class="bg-surface text-gray-300 font-sans antialiased h-screen overflow-hidden">

  <!-- â•â•â• Top Bar â•â•â• -->
  <header class="h-14 bg-surface-1 border-b border-border flex items-center justify-between px-3 md:px-4 z-50 fixed top-0 left-0 right-0">
    <div class="flex items-center gap-2 md:gap-3">
      <button onclick="toggleMobileSidebar()" class="md:hidden text-gray-400 hover:text-white p-1" aria-label="Toggle sidebar">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
      <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-amd-red to-electric flex items-center justify-center">
        <span class="text-white font-mono font-bold text-sm">A</span>
      </div>
      <h1 class="font-mono font-semibold text-white text-sm tracking-wide hidden sm:block">AjayaDesign<span class="text-electric">::</span>Admin</h1>
    </div>
    <div class="flex items-center gap-2 md:gap-4">
      <button onclick="openAddClientModal()" class="flex items-center gap-1.5 px-2 md:px-3 py-1.5 bg-electric/10 text-electric border border-electric/30 rounded-lg font-mono text-xs font-semibold hover:bg-electric/20 transition">
        â• <span class="hidden sm:inline">Add Client</span>
      </button>
      <div id="connection-status" class="hidden sm:flex items-center gap-2 text-xs font-mono">
        <span class="w-2 h-2 rounded-full bg-gray-600" id="conn-dot"></span>
        <span id="conn-text" class="text-gray-500">Disconnected</span>
      </div>
      <a href="/" class="hidden md:inline text-xs font-mono text-gray-500 hover:text-electric transition">â† Site</a>
      <button onclick="signOut()" class="text-xs font-mono text-gray-500 hover:text-brand-link transition">Sign Out</button>
    </div>
  </header>

  <!-- â•â•â• Mobile Sidebar Backdrop â•â•â• -->
  <div id="sidebar-backdrop" class="fixed inset-0 bg-black/60 z-30 hidden md:hidden" onclick="toggleMobileSidebar()"></div>

  <!-- â•â•â• Main Layout â•â•â• -->
  <div class="flex mt-14 h-[calc(100dvh-6.5rem)] md:h-[calc(100vh-3.5rem)]">

    <!-- â•â•â• Sidebar â•â•â• -->
    <aside id="sidebar" class="fixed top-14 bottom-0 left-0 z-40 w-72 min-w-[18rem] bg-surface-1 border-r border-border flex flex-col -translate-x-full transition-transform duration-300 ease-in-out md:static md:z-auto md:translate-x-0 md:transition-none">
      <!-- Tab Switcher (desktop only â€” mobile uses bottom bar) -->
      <div class="hidden md:flex border-b border-border overflow-x-auto no-scrollbar">
        <button onclick="switchTab('builds')" id="tab-builds"
          class="flex-1 py-3 text-xs font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-electric text-electric transition">
          ğŸ”¨ Builds
        </button>
        <button onclick="switchTab('leads')" id="tab-leads"
          class="flex-1 py-3 text-xs font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
          ğŸ“¬ Leads <span id="stat-leads" class="ml-1 px-1.5 py-0.5 rounded-full bg-electric/20 text-electric text-[0.6rem]">0</span>
        </button>
        <button onclick="switchTab('portfolio')" id="tab-portfolio"
          class="flex-1 py-3 text-xs font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
          ğŸ“ Portfolio
        </button>
        <button onclick="switchTab('history')" id="tab-history"
          class="flex-1 py-3 text-xs font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
          ğŸ“œ History
        </button>
        <button onclick="switchTab('analytics')" id="tab-analytics"
          class="flex-1 py-3 text-xs font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
          ğŸ“Š Analytics
        </button>
        <button onclick="switchTab('traffic')" id="tab-traffic"
          class="flex-1 py-3 text-xs font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
          ğŸŒ Traffic
        </button>
      </div>

      <!-- Builds Tab -->
      <div id="builds-tab" class="flex-1 flex flex-col overflow-hidden">
        <!-- Stats -->
        <div class="p-4 border-b border-border">
          <div class="flex items-center justify-between mb-3">
            <h2 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">History</h2>
            <button onclick="refreshBuilds()" class="text-gray-500 hover:text-electric transition" title="Refresh">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
            </button>
          </div>
          <div class="grid grid-cols-3 gap-2">
            <div class="bg-surface-2 rounded-lg p-2 text-center">
              <div id="stat-total" class="font-mono text-lg font-bold text-white">0</div>
              <div class="text-[0.65rem] text-gray-500 uppercase">Total</div>
            </div>
            <div class="bg-surface-2 rounded-lg p-2 text-center">
              <div id="stat-success" class="font-mono text-lg font-bold text-neon-green">0</div>
              <div class="text-[0.65rem] text-gray-500 uppercase">Pass</div>
            </div>
            <div class="bg-surface-2 rounded-lg p-2 text-center">
              <div id="stat-failed" class="font-mono text-lg font-bold text-brand-link">0</div>
              <div class="text-[0.65rem] text-gray-500 uppercase">Fail</div>
            </div>
          </div>
        </div>
        <!-- Build List -->
        <div id="build-list" class="flex-1 overflow-y-auto no-scrollbar p-2 space-y-1">
          <div class="text-center text-gray-600 text-xs font-mono py-8">Loading builds...</div>
        </div>
      </div>

      <!-- Leads Tab (hidden initially) -->
      <div id="leads-panel" class="flex-1 overflow-hidden hidden flex flex-col">
        <div class="p-4 border-b border-border">
          <h2 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">Client Requests</h2>
        </div>
        <!-- Active / Archived sub-tabs -->
        <div class="flex border-b border-border bg-surface-1">
          <button onclick="switchLeadsSubTab('active')" id="leads-subtab-active"
            class="flex-1 py-2 text-[0.65rem] font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-electric text-electric transition">
            Active <span id="stat-leads-active" class="ml-1 px-1.5 py-0.5 rounded-full bg-electric/20 text-electric text-[0.55rem]">0</span>
          </button>
          <button onclick="switchLeadsSubTab('archived')" id="leads-subtab-archived"
            class="flex-1 py-2 text-[0.65rem] font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
            Archived <span id="stat-leads-archived" class="ml-1 px-1.5 py-0.5 rounded-full bg-gray-800 text-gray-500 text-[0.55rem]">0</span>
          </button>
        </div>
        <!-- Active leads list -->
        <div id="leads-panel-content" class="flex-1 overflow-y-auto no-scrollbar p-3 space-y-3">
          <div class="text-center text-gray-600 text-xs font-mono py-8">Loading leads...</div>
        </div>
        <!-- Archived leads list (hidden initially) -->
        <div id="archived-panel-content" class="flex-1 overflow-y-auto no-scrollbar p-3 space-y-3 hidden">
          <div class="text-center text-gray-600 text-xs font-mono py-8">No archived leads</div>
        </div>
      </div>

      <!-- Portfolio Tab (hidden initially) -->
      <div id="portfolio-panel" class="flex-1 overflow-hidden hidden flex flex-col">
        <div class="p-4 border-b border-border">
          <div class="flex items-center justify-between">
            <h2 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">Finished Sites</h2>
            <button onclick="seedPortfolioSites()" class="text-[0.65rem] font-mono px-2 py-1 rounded bg-neon-green/10 text-neon-green hover:bg-neon-green/20 transition" title="Seed existing sites">
              ğŸŒ± Seed
            </button>
          </div>
        </div>
        <!-- Portfolio sub-tabs -->
        <div class="flex border-b border-border bg-surface-1">
          <button onclick="switchPortfolioSubTab('sites')" id="portfolio-subtab-sites"
            class="flex-1 py-2 text-[0.65rem] font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-electric text-electric transition">
            ğŸŒ Sites
          </button>
          <button onclick="switchPortfolioSubTab('contracts')" id="portfolio-subtab-contracts"
            class="flex-1 py-2 text-[0.65rem] font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
            ğŸ“ Contracts
          </button>
          <button onclick="switchPortfolioSubTab('invoices')" id="portfolio-subtab-invoices"
            class="flex-1 py-2 text-[0.65rem] font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
            ğŸ’° Invoices
          </button>
        </div>
        <!-- Sites list -->
        <div id="portfolio-sites-list" class="flex-1 overflow-y-auto no-scrollbar p-3 space-y-3">
          <div class="text-center text-gray-600 text-xs font-mono py-8">Loading portfolio...</div>
        </div>
        <!-- Contracts list (hidden) -->
        <div id="portfolio-contracts-list" class="flex-1 overflow-y-auto no-scrollbar p-3 space-y-3 hidden">
          <div class="text-center text-gray-600 text-xs font-mono py-8">Loading contracts...</div>
        </div>
        <!-- Invoices list (hidden) -->
        <div id="portfolio-invoices-list" class="flex-1 overflow-y-auto no-scrollbar p-3 space-y-3 hidden">
          <div class="text-center text-gray-600 text-xs font-mono py-8">Loading invoices...</div>
        </div>
      </div>

      <!-- History Tab (hidden initially) -->
      <div id="history-panel" class="flex-1 overflow-hidden hidden flex flex-col">
        <div class="p-4 border-b border-border">
          <div class="flex items-center justify-between">
            <h2 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">Activity Trail</h2>
            <button onclick="loadActivityLog()" class="text-gray-500 hover:text-electric transition" title="Refresh">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
            </button>
          </div>
        </div>
        <!-- Filter sub-tabs -->
        <div class="flex border-b border-border bg-surface-1">
          <button onclick="filterActivityLog('all')" id="history-filter-all"
            class="flex-1 py-2 text-[0.65rem] font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-electric text-electric transition">
            All
          </button>
          <button onclick="filterActivityLog('contract')" id="history-filter-contract"
            class="flex-1 py-2 text-[0.65rem] font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
            ğŸ“ Contracts
          </button>
          <button onclick="filterActivityLog('invoice')" id="history-filter-invoice"
            class="flex-1 py-2 text-[0.65rem] font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
            ğŸ’° Invoices
          </button>
        </div>
        <!-- Activity timeline -->
        <div id="history-list" class="flex-1 overflow-y-auto no-scrollbar p-3 space-y-1">
          <div class="text-center text-gray-600 text-xs font-mono py-8">Loading activity...</div>
        </div>
      </div>

      <!-- Analytics Tab (hidden initially) -->
      <div id="analytics-sidebar" class="flex-1 overflow-hidden hidden flex flex-col">
        <div class="p-4 border-b border-border">
          <div class="flex items-center justify-between">
            <h2 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">Insights</h2>
            <button onclick="refreshAnalytics()" class="text-gray-500 hover:text-electric transition" title="Refresh">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
            </button>
          </div>
        </div>
        <!-- Quick KPIs -->
        <div class="p-3 space-y-2 border-b border-border">
          <div class="grid grid-cols-2 gap-2">
            <div class="bg-surface-2 rounded-lg p-2.5 text-center">
              <div id="kpi-revenue" class="font-mono text-lg font-bold text-neon-green">$0</div>
              <div class="text-[0.6rem] text-gray-500 uppercase">Revenue</div>
            </div>
            <div class="bg-surface-2 rounded-lg p-2.5 text-center">
              <div id="kpi-clients" class="font-mono text-lg font-bold text-electric">0</div>
              <div class="text-[0.6rem] text-gray-500 uppercase">Clients</div>
            </div>
            <div class="bg-surface-2 rounded-lg p-2.5 text-center">
              <div id="kpi-contracts" class="font-mono text-lg font-bold text-neon-purple">0</div>
              <div class="text-[0.6rem] text-gray-500 uppercase">Contracts</div>
            </div>
            <div class="bg-surface-2 rounded-lg p-2.5 text-center">
              <div id="kpi-invoices" class="font-mono text-lg font-bold text-neon-yellow">0</div>
              <div class="text-[0.6rem] text-gray-500 uppercase">Invoices</div>
            </div>
          </div>
        </div>
        <!-- Section jump links -->
        <div class="flex-1 overflow-y-auto no-scrollbar p-3 space-y-1">
          <p class="text-[0.6rem] text-gray-600 uppercase tracking-wider font-mono mb-2">Jump to</p>
          <button onclick="scrollAnalytics('sec-revenue')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">ğŸ’° Revenue & Payments</button>
          <button onclick="scrollAnalytics('sec-pipeline')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">ğŸ”„ Client Pipeline</button>
          <button onclick="scrollAnalytics('sec-engagement')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">ğŸ“ˆ Customer Engagement</button>
          <button onclick="scrollAnalytics('sec-builds')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">ğŸ”¨ Build Performance</button>
          <button onclick="scrollAnalytics('sec-storage')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">ğŸ’¾ Firebase Storage</button>
          <button onclick="scrollAnalytics('sec-activity')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">ğŸ“œ Activity Timeline</button>
        </div>
      </div>

      <!-- Traffic Tab (hidden initially) -->
      <div id="traffic-sidebar" class="flex-1 overflow-hidden hidden flex flex-col">
        <div class="p-4 border-b border-border">
          <div class="flex items-center justify-between">
            <h2 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">Site Traffic</h2>
            <button onclick="refreshTraffic()" class="text-gray-500 hover:text-electric transition" title="Refresh">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
            </button>
          </div>
        </div>
        <!-- Quick KPIs -->
        <div class="p-3 space-y-2 border-b border-border">
          <div class="grid grid-cols-2 gap-2">
            <div class="bg-surface-2 rounded-lg p-2.5 text-center">
              <div id="traffic-kpi-live" class="font-mono text-lg font-bold text-neon-green">0</div>
              <div class="text-[0.6rem] text-gray-500 uppercase">Live Now</div>
            </div>
            <div class="bg-surface-2 rounded-lg p-2.5 text-center">
              <div id="traffic-kpi-pageviews" class="font-mono text-lg font-bold text-electric">0</div>
              <div class="text-[0.6rem] text-gray-500 uppercase">Views Today</div>
            </div>
            <div class="bg-surface-2 rounded-lg p-2.5 text-center">
              <div id="traffic-kpi-sessions" class="font-mono text-lg font-bold text-neon-purple">0</div>
              <div class="text-[0.6rem] text-gray-500 uppercase">Sessions</div>
            </div>
            <div class="bg-surface-2 rounded-lg p-2.5 text-center">
              <div id="traffic-kpi-avg-duration" class="font-mono text-lg font-bold text-neon-yellow">0s</div>
              <div class="text-[0.6rem] text-gray-500 uppercase">Avg Duration</div>
            </div>
          </div>
        </div>
        <!-- Section jump links -->
        <div class="flex-1 overflow-y-auto no-scrollbar p-3 space-y-1">
          <p class="text-[0.6rem] text-gray-600 uppercase tracking-wider font-mono mb-2">Jump to</p>
          <button onclick="scrollTraffic('sec-live-visitors')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">ğŸ‘ï¸ Live Visitors</button>
          <button onclick="scrollTraffic('sec-traffic-overview')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">ğŸ“ˆ Traffic Overview</button>
          <button onclick="scrollTraffic('sec-top-pages')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">ğŸ“„ Top Pages</button>
          <button onclick="scrollTraffic('sec-traffic-sources')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">ğŸ”— Traffic Sources</button>
          <button onclick="scrollTraffic('sec-scroll-depth')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">ğŸ“œ Scroll Depth</button>
          <button onclick="scrollTraffic('sec-click-heatmap')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">ğŸ”¥ Click Heatmap</button>
          <button onclick="scrollTraffic('sec-performance')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">âš¡ Performance</button>
          <button onclick="scrollTraffic('sec-sessions')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">ğŸ—‚ï¸ Sessions</button>
        </div>
      </div>
    </aside>

    <!-- â•â•â• Main Content â•â•â• -->
    <main class="flex-1 flex flex-col overflow-hidden">

      <!-- No Build Selected State -->
      <div id="empty-state" class="flex-1 flex items-center justify-center">
        <div class="text-center">
          <div class="text-6xl mb-4 opacity-20">ğŸ”§</div>
          <h2 class="font-mono text-xl text-gray-500 mb-2">No build selected</h2>
          <p class="text-sm text-gray-600">Select a build from the sidebar or wait for a new one</p>
        </div>
      </div>

      <!-- Lead Detail (hidden initially) -->
      <div id="lead-detail" class="flex-1 flex flex-col overflow-hidden hidden">

        <!-- Lead Header -->
        <div class="p-3 md:p-6 bg-surface-1 border-b border-border">
          <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
            <div class="flex items-center gap-3">
              <span id="lead-status-badge" class="px-2.5 py-1 rounded-full text-xs font-mono font-semibold"></span>
              <h2 id="lead-business" class="font-mono text-xl font-bold text-white"></h2>
            </div>
            <div class="flex flex-wrap items-center gap-2">
              <select id="lead-status-select" onchange="updateLeadStatusFromDetail(this.value)"
                class="text-xs font-mono px-3 py-1.5 rounded-lg bg-surface-2 border border-border text-gray-300 cursor-pointer focus:border-electric focus:outline-none">
                <option value="new">NEW</option>
                <option value="contacted">CONTACTED</option>
                <option value="building">BUILDING</option>
                <option value="deployed">DEPLOYED</option>
                <option value="archived">ARCHIVED</option>
              </select>
            </div>
          </div>
          <div id="lead-meta" class="flex flex-wrap gap-3 md:gap-6 text-sm text-gray-400"></div>
        </div>

        <!-- Lead Content -->
        <div class="flex-1 overflow-y-auto p-3 md:p-6 pb-20 md:pb-6">
          <!-- Goals Section -->
          <div class="mb-8">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-3">ğŸ“‹ Project Goals</h3>
            <div id="lead-goals" class="bg-surface-2 rounded-xl border border-border p-5 text-sm text-gray-300 leading-relaxed"></div>
          </div>

          <!-- Info Grid -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <div class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1">Email</div>
              <div id="lead-email" class="text-sm text-electric font-mono"></div>
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <div class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1">Niche</div>
              <div id="lead-niche" class="text-sm text-gray-300"></div>
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <div class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1">Submitted</div>
              <div id="lead-time" class="text-sm text-gray-300"></div>
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <div class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1">Source</div>
              <div id="lead-source" class="text-sm text-gray-300 font-mono"></div>
            </div>
          </div>

          <!-- Extended Fields (populated by JS) -->
          <div id="lead-extra-fields" class="mb-8"></div>

          <!-- Actions -->
          <div>
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-3">âš¡ Actions</h3>
            <div class="flex flex-wrap gap-3">
              <button onclick="triggerBuildForLead()" class="inline-flex items-center gap-2 px-5 py-2.5 bg-electric/10 text-electric border border-electric/30 rounded-lg font-mono text-sm font-semibold hover:bg-electric/20 transition">
                ğŸš€ Trigger Build
              </button>
              <a id="lead-email-link" href="" class="inline-flex items-center gap-2 px-5 py-2.5 bg-surface-2 text-gray-300 border border-border rounded-lg font-mono text-sm hover:border-border-glow transition">
                âœ‰ï¸ Send Email
              </a>
              <button id="btn-archive-lead" onclick="archiveLead()" class="inline-flex items-center gap-2 px-5 py-2.5 bg-surface-2 text-gray-500 border border-border rounded-lg font-mono text-sm hover:text-brand-link hover:border-brand-link/30 transition">
                ğŸ—ƒï¸ Archive
              </button>
              <button id="btn-restore-lead" onclick="restoreLead()" class="hidden inline-flex items-center gap-2 px-5 py-2.5 bg-neon-green/10 text-neon-green border border-neon-green/30 rounded-lg font-mono text-sm hover:bg-neon-green/20 transition">
                â™»ï¸ Restore
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- â•â•â• Portfolio Site Detail (hidden initially) â•â•â• -->
      <div id="portfolio-detail" class="flex-1 flex flex-col overflow-hidden hidden">
        <div class="p-3 md:p-6 bg-surface-1 border-b border-border">
          <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
            <div class="flex items-center gap-3">
              <span class="px-2.5 py-1 rounded-full text-xs font-mono font-semibold bg-neon-green/20 text-neon-green">DEPLOYED</span>
              <h2 id="pf-client-name" class="font-mono text-xl font-bold text-white"></h2>
            </div>
            <div class="flex flex-wrap items-center gap-2">
              <button onclick="savePortfolioEdit()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-neon-green/10 text-neon-green border border-neon-green/30 hover:bg-neon-green/20 transition">ğŸ’¾ Save</button>
              <button onclick="createContractForSite()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-electric/10 text-electric border border-electric/30 hover:bg-electric/20 transition">ğŸ“ New Contract</button>
              <button onclick="createInvoiceForSite()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-neon-purple/10 text-neon-purple border border-neon-purple/30 hover:bg-neon-purple/20 transition">ğŸ’° New Invoice</button>
            </div>
          </div>
          <div id="pf-meta" class="flex flex-wrap gap-3 md:gap-6 text-sm text-gray-400"></div>
        </div>
        <div class="flex-1 overflow-y-auto p-3 md:p-6 pb-20 md:pb-6 space-y-6">
          <!-- Editable Fields Grid -->
          <div>
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-3">ğŸ“‹ Client Details</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Client Name</label>
                <input id="pf-edit-name" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Email</label>
                <input id="pf-edit-email" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Phone</label>
                <input id="pf-edit-phone" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Niche</label>
                <input id="pf-edit-niche" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Location</label>
                <input id="pf-edit-location" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Live URL</label>
                <input id="pf-edit-url" class="w-full bg-transparent border-b border-border text-sm text-electric font-mono focus:border-electric focus:outline-none py-1" />
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Brand Colors</label>
                <input id="pf-edit-colors" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Tagline</label>
                <input id="pf-edit-tagline" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
              </div>
              <div class="md:col-span-2 bg-surface-2 rounded-xl border border-border p-4">
                <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Goals</label>
                <textarea id="pf-edit-goals" rows="3" class="w-full bg-transparent border-b border-border text-sm text-gray-300 font-mono focus:border-electric focus:outline-none py-1 resize-none"></textarea>
              </div>
            </div>
          </div>
          <!-- Site Contracts -->
          <div id="pf-contracts-section">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-3">ğŸ“ Contracts</h3>
            <div id="pf-contracts-list" class="space-y-2">
              <p class="text-xs text-gray-600 font-mono">No contracts yet</p>
            </div>
          </div>
          <!-- Site Invoices -->
          <div id="pf-invoices-section">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-3">ğŸ’° Invoices</h3>
            <div id="pf-invoices-list" class="space-y-2">
              <p class="text-xs text-gray-600 font-mono">No invoices yet</p>
            </div>
          </div>
        </div>
      </div>

      <!-- â•â•â• Contract Detail / Builder (hidden initially) â•â•â• -->
      <div id="contract-detail" class="flex-1 flex flex-col overflow-hidden hidden">
        <div class="p-3 md:p-6 bg-surface-1 border-b border-border">
          <div class="flex flex-wrap items-center justify-between gap-3 mb-2">
            <div class="flex items-center gap-3">
              <span id="ct-status-badge" class="px-2.5 py-1 rounded-full text-xs font-mono font-semibold bg-gray-800 text-gray-400">DRAFT</span>
              <h2 class="font-mono text-lg font-bold text-white">ğŸ“ Contract Builder</h2>
            </div>
            <div class="flex flex-wrap items-center gap-2">
              <button onclick="saveContract()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-neon-green/10 text-neon-green border border-neon-green/30 hover:bg-neon-green/20 transition">ğŸ’¾ Save</button>
              <button onclick="sendContract()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-electric/10 text-electric border border-electric/30 hover:bg-electric/20 transition">ğŸ“§ Send to Client</button>
              <button onclick="downloadContractPDF()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-neon-purple/10 text-neon-purple border border-neon-purple/30 hover:bg-neon-purple/20 transition">ğŸ“„ Download PDF</button>
              <button onclick="logPastContractEvent()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-neon-yellow/10 text-neon-yellow border border-neon-yellow/30 hover:bg-neon-yellow/20 transition" title="Record a past event (sent via email, payment received, etc.)">ğŸ“œ Log Event</button>
              <button id="ct-btn-delete" onclick="deleteContract()" class="hidden text-xs font-mono px-3 py-1.5 rounded-lg bg-red-500/10 text-red-400 border border-red-500/30 hover:bg-red-500/20 transition" title="Delete this draft contract">ğŸ—‘ï¸ Delete</button>
            </div>
          </div>
          <div id="ct-meta" class="text-xs font-mono text-gray-500"></div>
        </div>
        <div class="flex-1 overflow-y-auto p-3 md:p-6 pb-20 md:pb-6 space-y-6">
          <!-- Signed Contract View (populated by JS when status=signed) -->
          <div id="ct-signed-view" class="hidden"></div>

          <!-- Editable Form (hidden when signed) -->
          <div id="ct-editable-form">
          <!-- Client & Project Info -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Client Name *</label>
              <input id="ct-client-name" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Client Email *</label>
              <input id="ct-client-email" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Client Phone</label>
              <input id="ct-client-phone" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Client Address</label>
              <input id="ct-client-address" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Project Name *</label>
              <input id="ct-project-name" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Total Amount ($)</label>
              <input id="ct-total-amount" type="number" step="0.01" class="w-full bg-transparent border-b border-border text-sm text-neon-green font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Deposit Amount ($)</label>
              <input id="ct-deposit-amount" type="number" step="0.01" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Payment Method</label>
              <select id="ct-payment-method" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1">
                <option value="" class="bg-surface">Select...</option>
                <option value="venmo" class="bg-surface">Venmo</option>
                <option value="zelle" class="bg-surface">Zelle</option>
                <option value="paypal" class="bg-surface">PayPal</option>
                <option value="bank" class="bg-surface">Bank Transfer</option>
              </select>
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Start Date</label>
              <input id="ct-start-date" type="date" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Est. Completion</label>
              <input id="ct-completion-date" type="date" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="md:col-span-2 bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Project Description</label>
              <textarea id="ct-project-desc" rows="3" class="w-full bg-transparent border-b border-border text-sm text-gray-300 font-mono focus:border-electric focus:outline-none py-1 resize-none"></textarea>
            </div>
            <div class="md:col-span-2 bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Payment Terms</label>
              <textarea id="ct-payment-terms" rows="2" class="w-full bg-transparent border-b border-border text-sm text-gray-300 font-mono focus:border-electric focus:outline-none py-1 resize-none"></textarea>
            </div>
          </div>

          <!-- Clauses -->
          <div>
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">ğŸ“‹ Contract Clauses</h3>
              <div class="flex items-center gap-2">
                <button onclick="addCustomClause()" class="text-[0.65rem] font-mono px-2 py-1 rounded bg-electric/10 text-electric hover:bg-electric/20 transition">+ Add Clause</button>
                <button onclick="resetClausesToDefault()" class="text-[0.65rem] font-mono px-2 py-1 rounded bg-surface-2 text-gray-500 hover:text-gray-300 transition">â†» Reset Defaults</button>
              </div>
            </div>
            <div id="ct-clauses-container" class="space-y-3">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Custom Notes -->
          <div>
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-3">ğŸ“ Custom Notes</h3>
            <textarea id="ct-custom-notes" rows="4" class="w-full bg-surface-2 rounded-xl border border-border p-4 text-sm text-gray-300 font-mono focus:border-electric focus:outline-none resize-none" placeholder="Additional terms or notes..."></textarea>
          </div>

          <!-- Signature Section (read-only, shows after signing) -->
          <div id="ct-signature-section" class="hidden">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-3">âœï¸ Signature</h3>
            <div class="bg-surface-2 rounded-xl border border-neon-green/30 p-4">
              <div class="flex items-center gap-4">
                <img id="ct-signature-img" src="" class="h-16 border border-border rounded" alt="Client signature" />
                <div>
                  <p id="ct-signer-name" class="font-mono text-sm text-white"></p>
                  <p id="ct-signed-at" class="text-xs text-gray-500 font-mono"></p>
                </div>
              </div>
            </div>
          </div>
          </div><!-- /ct-editable-form -->
        </div>
      </div>

      <!-- â•â•â• Invoice Detail (hidden initially) â•â•â• -->
      <div id="invoice-detail" class="flex-1 flex flex-col overflow-hidden hidden">
        <div class="p-3 md:p-6 bg-surface-1 border-b border-border">
          <div class="flex flex-wrap items-center justify-between gap-3 mb-2">
            <div class="flex items-center gap-3">
              <span id="inv-status-badge" class="px-2.5 py-1 rounded-full text-xs font-mono font-semibold bg-gray-800 text-gray-400">DRAFT</span>
              <h2 id="inv-number" class="font-mono text-lg font-bold text-white">ğŸ’° Invoice</h2>
            </div>
            <div class="flex flex-wrap items-center gap-2">
              <button onclick="saveInvoice()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-neon-green/10 text-neon-green border border-neon-green/30 hover:bg-neon-green/20 transition">ğŸ’¾ Save</button>
              <button onclick="sendInvoice()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-electric/10 text-electric border border-electric/30 hover:bg-electric/20 transition">ğŸ“§ Send to Client</button>
              <button onclick="payWithPayPal()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-blue-500/10 text-blue-400 border border-blue-500/30 hover:bg-blue-500/20 transition" title="Generate PayPal.me link (fee passed to client)">ğŸ’³ PayPal Link</button>
              <button onclick="markInvoicePaid()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-neon-green/10 text-neon-green border border-neon-green/30 hover:bg-neon-green/20 transition">âœ… Mark Paid</button>
              <button onclick="downloadInvoicePDF()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-neon-purple/10 text-neon-purple border border-neon-purple/30 hover:bg-neon-purple/20 transition">ğŸ“„ Download PDF</button>
              <button onclick="logPastInvoiceEvent()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-neon-yellow/10 text-neon-yellow border border-neon-yellow/30 hover:bg-neon-yellow/20 transition" title="Record a past event (payment received, sent, etc.)">ğŸ“œ Log Event</button>
            </div>
          </div>
        </div>
        <div class="flex-1 overflow-y-auto p-3 md:p-6 pb-20 md:pb-6 space-y-6">
          <!-- Client Info -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Client Name</label>
              <input id="inv-client-name" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Client Email</label>
              <input id="inv-client-email" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Payment Method</label>
              <select id="inv-payment-method" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1">
                <option value="" class="bg-surface">Select...</option>
                <option value="venmo" class="bg-surface">Venmo</option>
                <option value="zelle" class="bg-surface">Zelle</option>
                <option value="paypal" class="bg-surface">PayPal</option>
                <option value="bank" class="bg-surface">Bank Transfer</option>
              </select>
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Due Date</label>
              <input id="inv-due-date" type="date" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
          </div>

          <!-- Line Items -->
          <div>
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">ğŸ“¦ Line Items</h3>
              <button onclick="addInvoiceItem()" class="text-[0.65rem] font-mono px-2 py-1 rounded bg-electric/10 text-electric hover:bg-electric/20 transition">+ Add Item</button>
            </div>
            <div id="inv-items-container" class="space-y-2">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Totals -->
          <div class="bg-surface-2 rounded-xl border border-border p-4">
            <div class="grid grid-cols-2 gap-3 text-sm font-mono">
              <div class="text-gray-500">Subtotal</div>
              <div id="inv-subtotal" class="text-right text-white">$0.00</div>
              <div class="text-gray-500">Tax Rate (%)</div>
              <div><input id="inv-tax-rate" type="number" step="0.01" value="0" class="w-full bg-transparent text-right text-white font-mono focus:outline-none" onchange="recalcInvoice()" /></div>
              <div class="text-gray-500">Tax</div>
              <div id="inv-tax-amount" class="text-right text-white">$0.00</div>
              <div class="text-white font-bold text-lg border-t border-border pt-2">Total</div>
              <div id="inv-total" class="text-right text-neon-green font-bold text-lg border-t border-border pt-2">$0.00</div>
            </div>
          </div>

          <!-- Notes -->
          <div>
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-3">ğŸ“ Notes</h3>
            <textarea id="inv-notes" rows="3" class="w-full bg-surface-2 rounded-xl border border-border p-4 text-sm text-gray-300 font-mono focus:border-electric focus:outline-none resize-none" placeholder="Payment instructions, thank you note..."></textarea>
          </div>

          <!-- Payment Plan -->
          <div class="bg-surface-2 rounded-xl border border-border p-4">
            <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
              <div class="flex items-center gap-3">
                <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">ğŸ“… Payment Plan</h3>
                <label class="flex items-center gap-2 cursor-pointer">
                  <input type="checkbox" id="inv-payment-plan-enabled" onchange="togglePaymentPlan()" class="rounded border-border bg-surface text-electric focus:ring-electric focus:ring-offset-0 w-4 h-4">
                  <span class="text-xs text-gray-500 font-mono">Enable</span>
                </label>
              </div>
              <div id="pp-controls" class="hidden flex flex-wrap items-center gap-2">
                <input type="number" id="pp-num-installments" value="4" min="2" max="36" class="w-16 bg-surface border border-border rounded text-xs text-white font-mono text-center py-1 focus:border-electric focus:outline-none" title="Number of installments" />
                <button onclick="generatePaymentPlan()" class="text-[0.65rem] font-mono px-2 py-1 rounded bg-electric/10 text-electric hover:bg-electric/20 transition">âš¡ Auto-Generate</button>
                <button onclick="addInstallment()" class="text-[0.65rem] font-mono px-2 py-1 rounded bg-neon-green/10 text-neon-green hover:bg-neon-green/20 transition">+ Add</button>
                <button onclick="sendPaymentReminder()" class="text-[0.65rem] font-mono px-2 py-1 rounded bg-neon-yellow/10 text-neon-yellow hover:bg-neon-yellow/20 transition">ğŸ”” Send Reminder</button>
              </div>
            </div>
            <div id="pp-summary" class="hidden mb-3">
              <div class="grid grid-cols-3 gap-3 text-center">
                <div class="bg-surface rounded-lg p-2">
                  <div id="pp-paid-count" class="text-neon-green font-mono font-bold text-lg">0</div>
                  <div class="text-[0.6rem] text-gray-600 uppercase">Paid</div>
                </div>
                <div class="bg-surface rounded-lg p-2">
                  <div id="pp-pending-count" class="text-neon-yellow font-mono font-bold text-lg">0</div>
                  <div class="text-[0.6rem] text-gray-600 uppercase">Pending</div>
                </div>
                <div class="bg-surface rounded-lg p-2">
                  <div id="pp-overdue-count" class="text-red-400 font-mono font-bold text-lg">0</div>
                  <div class="text-[0.6rem] text-gray-600 uppercase">Overdue</div>
                </div>
              </div>
            </div>
            <div id="pp-installments" class="hidden space-y-2">
              <!-- Populated by JS -->
            </div>
          </div>

        </div>
      </div>

      <!-- Build Detail (hidden initially) -->
      <div id="build-detail" class="flex-1 flex flex-col overflow-hidden hidden">

        <!-- Build Header -->
        <div id="build-header" class="p-3 md:p-4 bg-surface-1 border-b border-border">
          <div class="flex flex-wrap items-center justify-between gap-2 mb-3">
            <div class="flex items-center gap-3">
              <span id="build-status-badge" class="px-2.5 py-1 rounded-full text-xs font-mono font-semibold"></span>
              <h2 id="build-client" class="font-mono text-lg font-bold text-white"></h2>
            </div>
            <div class="flex items-center gap-3 text-xs font-mono text-gray-500">
              <span id="build-id-display"></span>
              <span id="build-time"></span>
            </div>
          </div>
          <div id="build-meta" class="flex flex-wrap gap-2 md:gap-4 text-xs text-gray-400"></div>
        </div>

        <!-- Step Progress Bar -->
        <div id="step-progress" class="px-3 md:px-6 py-4 bg-surface-2 border-b border-border">
          <div class="flex items-center justify-between max-w-3xl mx-auto">
            <!-- Steps rendered by JS -->
          </div>
        </div>

        <!-- Content Area: Pipeline / AI / Logs -->
        <div class="flex-1 flex flex-col overflow-hidden">

          <!-- Content Tabs -->
          <div class="flex border-b border-border bg-surface-1 overflow-x-auto no-scrollbar">
            <button onclick="switchContentTab('pipeline')" id="ctab-pipeline"
              class="px-5 py-2.5 text-xs font-mono font-semibold uppercase tracking-widest border-b-2 border-electric text-electric transition">
              âš¡ Pipeline
            </button>
            <button onclick="switchContentTab('ai')" id="ctab-ai"
              class="px-5 py-2.5 text-xs font-mono font-semibold uppercase tracking-widest border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
              ğŸ¤– AI Activity
            </button>
            <button onclick="switchContentTab('log')" id="ctab-log"
              class="px-5 py-2.5 text-xs font-mono font-semibold uppercase tracking-widest border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
              ğŸ“Ÿ Log <span id="log-count" class="ml-1 text-gray-600">0</span>
            </button>
            <div class="ml-auto hidden sm:flex items-center gap-2 pr-4">
              <label class="flex items-center gap-1.5 text-xs text-gray-500 cursor-pointer">
                <input type="checkbox" id="auto-scroll" checked class="rounded border-border bg-surface-2 text-electric focus:ring-electric focus:ring-offset-0 w-3.5 h-3.5">
                Auto-scroll
              </label>
            </div>
          </div>

          <!-- â•â•â• Pipeline Graph View â•â•â• -->
          <div id="content-pipeline" class="flex-1 overflow-y-auto p-3 md:p-6">
            <div id="pipeline-graph" class="pipeline-container max-w-4xl mx-auto">
              <!-- Rendered by JS -->
              <div class="text-center text-gray-600 text-xs font-mono py-12">Waiting for build to start...</div>
            </div>
          </div>

          <!-- â•â•â• AI Activity Panel (hidden initially) â•â•â• -->
          <div id="content-ai" class="flex-1 overflow-y-auto p-3 space-y-3 hidden">
            <div id="ai-panel" class="space-y-3">
              <div class="text-center text-gray-600 text-xs font-mono py-8">No AI activity yet</div>
            </div>
          </div>

          <!-- â•â•â• Build Log Panel (hidden initially) â•â•â• -->
          <div id="content-log" class="flex-1 overflow-y-auto p-4 font-mono text-xs leading-relaxed hidden">
            <div id="log-panel">
              <div class="text-gray-600">Waiting for build output...</div>
            </div>
          </div>

        </div>
      </div>

      <!-- â•â•â• Analytics Panel (hidden initially) â•â•â• -->
      <div id="analytics-panel" class="flex-1 flex flex-col overflow-hidden hidden">
        <!-- Header -->
        <div class="p-3 md:p-6 bg-surface-1 border-b border-border">
          <div class="flex flex-wrap items-center justify-between gap-3">
            <div class="flex items-center gap-3">
              <span class="text-2xl">ğŸ“Š</span>
              <div>
                <h2 class="font-mono text-xl font-bold text-white">Business Analytics</h2>
                <p id="analytics-updated" class="text-xs text-gray-500 font-mono">Loading...</p>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <select id="analytics-period" onchange="refreshAnalytics()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-surface-2 border border-border text-gray-300 cursor-pointer focus:border-electric focus:outline-none">
                <option value="7">Last 7 days</option>
                <option value="30" selected>Last 30 days</option>
                <option value="90">Last 90 days</option>
                <option value="365">All time</option>
              </select>
              <button onclick="refreshAnalytics()" class="p-2 rounded-lg bg-surface-2 border border-border text-gray-400 hover:text-electric hover:border-electric transition">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Scrollable content -->
        <div id="analytics-scroll" class="flex-1 overflow-y-auto scroll-contain p-3 md:p-6 space-y-6 pb-20 md:pb-6">

          <!-- â•â•â• Revenue & Payments â•â•â• -->
          <section id="sec-revenue">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">ğŸ’° Revenue &amp; Payments</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-total-revenue" class="font-mono text-xl font-bold text-neon-green">$0</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Total Revenue</div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-collected" class="font-mono text-xl font-bold text-electric">$0</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Collected</div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-outstanding" class="font-mono text-xl font-bold text-neon-yellow">$0</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Outstanding</div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-collection-rate" class="font-mono text-xl font-bold text-neon-purple">0%</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Collection Rate</div>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Revenue Over Time</h4>
                <div class="h-48"><canvas id="chart-revenue"></canvas></div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Payment Status Breakdown</h4>
                <div class="h-48 flex items-center justify-center"><canvas id="chart-payment-status"></canvas></div>
              </div>
            </div>
          </section>

          <!-- â•â•â• Client Pipeline â•â•â• -->
          <section id="sec-pipeline">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">ğŸ”„ Client Pipeline</h3>
            <div id="pipeline-funnel" class="space-y-2 mb-4"></div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Lead Sources</h4>
                <div class="h-48 flex items-center justify-center"><canvas id="chart-lead-sources"></canvas></div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Client Niches</h4>
                <div class="h-48 flex items-center justify-center"><canvas id="chart-niches"></canvas></div>
              </div>
            </div>
          </section>

          <!-- â•â•â• Customer Engagement â•â•â• -->
          <section id="sec-engagement">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">ğŸ“ˆ Customer Engagement</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-avg-deal" class="font-mono text-xl font-bold text-electric">$0</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Avg Deal Size</div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-sign-rate" class="font-mono text-xl font-bold text-neon-green">0%</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Contract Sign Rate</div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-avg-time-sign" class="font-mono text-xl font-bold text-neon-yellow">â€”</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Avg Time to Sign</div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-repeat-rate" class="font-mono text-xl font-bold text-neon-purple">0%</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Repeat Client Rate</div>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Contract Status Flow</h4>
                <div class="h-48 flex items-center justify-center"><canvas id="chart-contract-flow"></canvas></div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Monthly Activity</h4>
                <div class="h-48"><canvas id="chart-monthly-activity"></canvas></div>
              </div>
            </div>
            <!-- Top clients table -->
            <div class="bg-surface-2 rounded-xl border border-border p-4 mt-4">
              <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Top Clients by Revenue</h4>
              <div id="top-clients-table" class="overflow-x-auto"></div>
            </div>
          </section>

          <!-- â•â•â• Build Performance â•â•â• -->
          <section id="sec-builds">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">ğŸ”¨ Build Performance</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-total-builds" class="font-mono text-xl font-bold text-white">0</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Total Builds</div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-build-success" class="font-mono text-xl font-bold text-neon-green">0%</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Success Rate</div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-avg-build-time" class="font-mono text-xl font-bold text-electric">â€”</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Avg Build Time</div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-sites-live" class="font-mono text-xl font-bold text-neon-yellow">0</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Sites Live</div>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Build Outcomes</h4>
                <div class="h-48 flex items-center justify-center"><canvas id="chart-build-outcomes"></canvas></div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Builds Over Time</h4>
                <div class="h-48"><canvas id="chart-builds-timeline"></canvas></div>
              </div>
            </div>
          </section>

          <!-- â•â•â• Firebase Storage â•â•â• -->
          <section id="sec-storage">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">ğŸ’¾ Firebase Realtime DB Storage</h3>
            <div class="bg-surface-2 rounded-xl border border-border p-4 mb-4">
              <!-- Gauge bar -->
              <div class="flex items-center justify-between mb-2">
                <span class="font-mono text-xs text-gray-400">Usage</span>
                <span id="storage-usage-text" class="font-mono text-xs text-electric">Calculating...</span>
              </div>
              <div class="w-full bg-surface rounded-full h-4 overflow-hidden border border-border">
                <div id="storage-bar" class="h-full rounded-full bg-gradient-to-r from-electric to-neon-green transition-all duration-700" style="width:0%"></div>
              </div>
              <div class="flex items-center justify-between mt-1">
                <span class="text-[0.6rem] text-gray-600 font-mono">0 MB</span>
                <span class="text-[0.6rem] text-gray-600 font-mono">1 GB (free tier)</span>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Storage by Node</h4>
                <div class="h-48 flex items-center justify-center"><canvas id="chart-storage"></canvas></div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Node Details</h4>
                <div id="storage-breakdown" class="space-y-2"></div>
              </div>
            </div>
          </section>

          <!-- â•â•â• Activity Timeline Chart â•â•â• -->
          <section id="sec-activity">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">ğŸ“œ Activity Heatmap</h3>
            <div class="bg-surface-2 rounded-xl border border-border p-4 mb-4">
              <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Daily Actions (last 30 days)</h4>
              <div class="h-48"><canvas id="chart-activity-heatmap"></canvas></div>
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Recent Events</h4>
              <div id="recent-events-list" class="space-y-1 max-h-64 overflow-y-auto overflow-x-auto no-scrollbar"></div>
            </div>
          </section>

        </div>
      </div>

      <!-- â•â•â• Traffic Panel â•â•â• -->
      <div id="traffic-panel" class="flex-1 flex flex-col overflow-hidden hidden">
        <!-- Header -->
        <div class="p-3 md:p-6 bg-surface-1 border-b border-border">
          <div class="flex flex-wrap items-center justify-between gap-3">
            <div class="flex items-center gap-3">
              <span class="text-2xl">ğŸŒ</span>
              <div>
                <h2 class="font-mono text-xl font-bold text-white">Site Traffic</h2>
                <p id="traffic-updated" class="text-xs text-gray-500 font-mono">Live data from site_analytics</p>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <button onclick="refreshTraffic()" class="p-2 rounded-lg bg-surface-2 border border-border text-gray-400 hover:text-electric hover:border-electric transition">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Scrollable content -->
        <div id="traffic-scroll" class="flex-1 overflow-y-auto scroll-contain p-3 md:p-6 space-y-6 pb-20 md:pb-6">

          <!-- â•â•â• Live Visitors â•â•â• -->
          <section id="sec-live-visitors">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">ğŸ‘ï¸ Live Visitors</h3>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <div class="flex items-center gap-2 mb-3">
                <span class="w-2.5 h-2.5 bg-neon-green rounded-full animate-pulse"></span>
                <span id="traffic-live-count" class="font-mono text-sm text-neon-green font-bold">0</span>
                <span class="text-xs text-gray-500 font-mono">visitors online now</span>
              </div>
              <!-- Header row -->
              <div class="flex items-center justify-between py-1.5 px-2 text-[0.6rem] text-gray-600 font-mono uppercase tracking-wider border-b border-border mb-1">
                <span class="w-24">Visitor</span>
                <span class="flex-1">Page</span>
                <span class="w-16">Device</span>
                <span class="w-16 text-right">Time on</span>
              </div>
              <div id="traffic-live-table" class="overflow-x-auto">
                <p class="text-gray-500 text-xs font-mono text-center py-6">Waiting for visitorsâ€¦</p>
              </div>
            </div>
          </section>

          <!-- â•â•â• Traffic Overview (30-day chart) â•â•â• -->
          <section id="sec-traffic-overview">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">ğŸ“ˆ Traffic Overview (30 days)</h3>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <div class="h-56"><canvas id="traffic-chart-overview"></canvas></div>
            </div>
          </section>

          <!-- â•â•â• Top Pages & Referrers â•â•â• -->
          <section id="sec-top-pages">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">ğŸ“„ Top Pages & Referrers</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Most Visited Pages</h4>
                <div id="traffic-top-pages">
                  <p class="text-gray-500 text-xs font-mono py-4">Loadingâ€¦</p>
                </div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Top Referrers</h4>
                <div id="traffic-top-referrers">
                  <p class="text-gray-500 text-xs font-mono py-4">Loadingâ€¦</p>
                </div>
              </div>
            </div>
          </section>

          <!-- â•â•â• Traffic Sources & Devices â•â•â• -->
          <section id="sec-traffic-sources">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">ğŸ”— Traffic Sources & Devices</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Source Breakdown</h4>
                <div class="h-48 flex items-center justify-center"><canvas id="traffic-chart-sources"></canvas></div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Device Breakdown</h4>
                <div class="h-48 flex items-center justify-center"><canvas id="traffic-chart-devices"></canvas></div>
              </div>
            </div>
          </section>

          <!-- â•â•â• Scroll Depth â•â•â• -->
          <section id="sec-scroll-depth">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">ğŸ“œ Scroll Depth</h3>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <div class="h-48"><canvas id="traffic-chart-scroll"></canvas></div>
            </div>
          </section>

          <!-- â•â•â• Click Heatmap â•â•â• -->
          <section id="sec-click-heatmap">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">ğŸ”¥ Click Heatmap</h3>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <div class="flex items-center gap-3 mb-4">
                <select id="traffic-heatmap-page" onchange="loadTrafficHeatmap()"
                  class="text-xs font-mono px-3 py-1.5 rounded-lg bg-surface border border-border text-gray-300 cursor-pointer focus:border-electric focus:outline-none">
                  <option value="">Select pageâ€¦</option>
                </select>
              </div>
              <div class="h-64"><canvas id="traffic-chart-clicks"></canvas></div>
            </div>
          </section>

          <!-- â•â•â• Performance â•â•â• -->
          <section id="sec-performance">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">âš¡ Performance Metrics</h3>
            <div id="traffic-perf-grid" class="grid grid-cols-2 md:grid-cols-5 gap-3">
              <p class="text-gray-500 text-xs font-mono text-center py-6 col-span-full">Loadingâ€¦</p>
            </div>
          </section>

          <!-- â•â•â• Sessions â•â•â• -->
          <section id="sec-sessions">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">ğŸ—‚ï¸ Recent Sessions</h3>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <!-- Header row -->
              <div class="flex items-center gap-2 py-1.5 px-2 text-[0.6rem] text-gray-600 font-mono uppercase tracking-wider border-b border-border mb-1 min-w-0">
                <span class="w-16 shrink-0">Visitor</span>
                <span class="w-14 shrink-0 hidden sm:block">Device</span>
                <span class="w-10 shrink-0">Pages</span>
                <span class="w-14 shrink-0">Duration</span>
                <span class="w-14 shrink-0 hidden sm:block">Source</span>
                <span class="flex-1 text-right">When</span>
              </div>
              <div id="traffic-sessions-list" class="overflow-x-auto">
                <p class="text-gray-500 text-xs font-mono text-center py-6">Loadingâ€¦</p>
              </div>
            </div>
          </section>

        </div>
      </div>

    </main>
  </div>

  <!-- â•â•â• Login Screen (shown when not authenticated) â•â•â• -->
  <div id="login-screen" class="fixed inset-0 bg-surface z-[100] flex items-center justify-center">
    <div class="text-center">
      <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-amd-red to-electric flex items-center justify-center mx-auto mb-6">
        <span class="text-white font-mono font-bold text-2xl">A</span>
      </div>
      <h1 class="font-mono text-2xl font-bold text-white mb-2">AjayaDesign<span class="text-electric">::</span>Admin</h1>
      <p class="text-gray-500 text-sm mb-8">Sign in to access the dashboard</p>
      <button id="google-login-btn" class="inline-flex items-center gap-3 px-6 py-3 bg-white text-gray-800 font-semibold rounded-lg hover:bg-gray-100 transition shadow-lg">
        <svg class="w-5 h-5" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 01-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
        Sign in with Google
      </button>
      <p id="login-error" class="text-brand-link text-xs mt-4 hidden"></p>
    </div>
  </div>

  <!-- â•â•â• Add Client Modal â•â•â• -->
  <div id="add-client-modal" class="fixed inset-0 z-[100] hidden">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/70 backdrop-blur-sm" onclick="closeAddClientModal()"></div>
    <!-- Modal -->
    <div class="absolute inset-4 md:inset-y-8 md:inset-x-auto md:max-w-2xl md:mx-auto bg-surface-1 rounded-2xl border border-border shadow-2xl flex flex-col overflow-hidden animate-slide-up">
      <!-- Header -->
      <div class="flex items-center justify-between p-5 border-b border-border">
        <h2 class="font-mono font-semibold text-white text-sm">â• Add New Client</h2>
        <button onclick="closeAddClientModal()" class="text-gray-500 hover:text-white transition text-xl leading-none">&times;</button>
      </div>

      <!-- Tabs -->
      <div class="flex border-b border-border">
        <button id="acm-tab-manual" onclick="switchAddClientTab('manual')"
          class="flex-1 py-3 text-xs font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-electric text-electric transition">
          Manual Form
        </button>
        <button id="acm-tab-ai" onclick="switchAddClientTab('ai')"
          class="flex-1 py-3 text-xs font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
          AI Paste &amp; Parse
        </button>
      </div>

      <!-- Scrollable Content -->
      <div class="flex-1 overflow-y-auto p-5 space-y-4">

        <!-- â”€â”€ AI Parse Panel â”€â”€ -->
        <div id="acm-ai-panel" class="hidden space-y-4">
          <p class="text-xs text-gray-400 font-mono">Paste client details below â€” email, text message, notes, anything. AI will extract the fields.</p>
          <textarea id="acm-raw-text" rows="6"
            placeholder="Hey Aj, I run a bakery called Sunrise Bakery in Portland OR. We need a website to showcase our artisan breads..."
            class="w-full px-4 py-3 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric focus:ring-1 focus:ring-electric/50 transition-colors resize-none"></textarea>
          <button onclick="parseWithAI()" id="acm-parse-btn"
            class="flex items-center gap-2 px-4 py-2.5 bg-electric/10 text-electric border border-electric/30 rounded-lg font-mono text-xs font-semibold hover:bg-electric/20 transition">
            ğŸ¤– Parse with AI
          </button>
          <div id="acm-parse-status" class="hidden text-xs font-mono"></div>
        </div>

        <!-- â”€â”€ Form Fields (shared by Manual and AI-parsed) â”€â”€ -->
        <div id="acm-form-fields">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Business Name -->
            <div class="md:col-span-2">
              <label class="block font-mono text-xs text-gray-500 mb-1">Business Name <span class="text-red-400">*</span></label>
              <input id="acm-business-name" type="text" required
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition" placeholder="e.g. Sunrise Bakery" />
            </div>
            <!-- Niche -->
            <div>
              <label class="block font-mono text-xs text-gray-500 mb-1">Niche / Industry <span class="text-red-400">*</span></label>
              <input id="acm-niche" type="text" required
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition" placeholder="e.g. Artisan Bakery" />
            </div>
            <!-- Email -->
            <div>
              <label class="block font-mono text-xs text-gray-500 mb-1">Email <span class="text-red-400">*</span></label>
              <input id="acm-email" type="email" required
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition" placeholder="hello@client.com" />
            </div>
            <!-- Goals -->
            <div class="md:col-span-2">
              <label class="block font-mono text-xs text-gray-500 mb-1">Goals <span class="text-red-400">*</span></label>
              <textarea id="acm-goals" rows="2"
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition resize-none" placeholder="What should the website accomplish?"></textarea>
            </div>
            <!-- Phone -->
            <div>
              <label class="block font-mono text-xs text-gray-500 mb-1">Phone</label>
              <input id="acm-phone" type="tel"
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition" placeholder="(503) 555-1234" />
            </div>
            <!-- Location -->
            <div>
              <label class="block font-mono text-xs text-gray-500 mb-1">Location</label>
              <input id="acm-location" type="text"
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition" placeholder="Portland, OR" />
            </div>
            <!-- Existing Website -->
            <div>
              <label class="block font-mono text-xs text-gray-500 mb-1">Existing Website</label>
              <input id="acm-existing-website" type="url"
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition" placeholder="https://current-site.com" />
            </div>
            <!-- Brand Colors -->
            <div>
              <label class="block font-mono text-xs text-gray-500 mb-1">Brand Colors</label>
              <input id="acm-brand-colors" type="text"
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition" placeholder="Navy blue #1a365d, Gold" />
            </div>
            <!-- Tagline -->
            <div class="md:col-span-2">
              <label class="block font-mono text-xs text-gray-500 mb-1">Tagline / Slogan</label>
              <input id="acm-tagline" type="text"
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition" placeholder="e.g. Fresh Baked Daily Since 1985" />
            </div>
            <!-- Target Audience -->
            <div class="md:col-span-2">
              <label class="block font-mono text-xs text-gray-500 mb-1">Target Audience</label>
              <input id="acm-target-audience" type="text"
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition" placeholder="e.g. Young professionals aged 25-40" />
            </div>
            <!-- Competitor URLs -->
            <div class="md:col-span-2">
              <label class="block font-mono text-xs text-gray-500 mb-1">Competitor URLs</label>
              <textarea id="acm-competitor-urls" rows="2"
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition resize-none" placeholder="One URL per line"></textarea>
            </div>
            <!-- Additional Notes -->
            <div class="md:col-span-2">
              <label class="block font-mono text-xs text-gray-500 mb-1">Additional Notes</label>
              <textarea id="acm-additional-notes" rows="2"
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition resize-none" placeholder="Special hours, certifications, awards..."></textarea>
            </div>
            <!-- Rebuild -->
            <div class="md:col-span-2">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" id="acm-rebuild" class="w-4 h-4 rounded border-border bg-surface text-electric focus:ring-electric/50" />
                <span class="font-mono text-xs text-gray-400">Rebuild existing site</span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer Actions -->
      <div class="p-5 border-t border-border flex items-center justify-between gap-3">
        <button onclick="closeAddClientModal()" class="px-4 py-2.5 text-gray-500 font-mono text-xs hover:text-white transition">Cancel</button>
        <div class="flex gap-3">
          <button onclick="saveNewLead(false)" class="px-4 py-2.5 bg-surface-2 text-gray-300 border border-border rounded-lg font-mono text-xs hover:border-border-glow transition">
            Save Lead Only
          </button>
          <button onclick="saveNewLead(true)" class="px-4 py-2.5 bg-electric/10 text-electric border border-electric/30 rounded-lg font-mono text-xs font-semibold hover:bg-electric/20 transition">
            ğŸš€ Save &amp; Build
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• Mobile Bottom Tab Bar â•â•â• -->
  <nav id="mobile-tab-bar" class="fixed bottom-0 left-0 right-0 z-50 md:hidden bg-surface-1 border-t border-border">
    <div class="flex h-12">
      <button onclick="switchTab('builds')" id="mtab-builds"
        class="mobile-tab flex-1 flex flex-col items-center justify-center text-electric transition">
        <span class="text-base leading-none">ğŸ”¨</span>
        <span class="text-[0.5rem] font-mono font-semibold uppercase tracking-wider mt-0.5">Builds</span>
      </button>
      <button onclick="switchTab('leads')" id="mtab-leads"
        class="mobile-tab flex-1 flex flex-col items-center justify-center text-gray-500 transition">
        <span class="text-base leading-none">ğŸ“¬</span>
        <span class="text-[0.5rem] font-mono font-semibold uppercase tracking-wider mt-0.5">Leads</span>
      </button>
      <button onclick="switchTab('portfolio')" id="mtab-portfolio"
        class="mobile-tab flex-1 flex flex-col items-center justify-center text-gray-500 transition">
        <span class="text-base leading-none">ğŸ“</span>
        <span class="text-[0.5rem] font-mono font-semibold uppercase tracking-wider mt-0.5">Portfolio</span>
      </button>
      <button onclick="switchTab('history')" id="mtab-history"
        class="mobile-tab flex-1 flex flex-col items-center justify-center text-gray-500 transition">
        <span class="text-base leading-none">ğŸ“œ</span>
        <span class="text-[0.5rem] font-mono font-semibold uppercase tracking-wider mt-0.5">History</span>
      </button>
      <button onclick="switchTab('analytics')" id="mtab-analytics"
        class="mobile-tab flex-1 flex flex-col items-center justify-center text-gray-500 transition">
        <span class="text-base leading-none">ğŸ“Š</span>
        <span class="text-[0.5rem] font-mono font-semibold uppercase tracking-wider mt-0.5">Analytics</span>
      </button>
      <button onclick="switchTab('traffic')" id="mtab-traffic"
        class="mobile-tab flex-1 flex flex-col items-center justify-center text-gray-500 transition">
        <span class="text-base leading-none">ğŸŒ</span>
        <span class="text-[0.5rem] font-mono font-semibold uppercase tracking-wider mt-0.5">Traffic</span>
      </button>
    </div>
  </nav>

  <!-- â•â•â• Firebase SDK â•â•â• -->
  <script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-database-compat.js"></script>
  <script src="../js/firebase-config.js"></script>
  <script>
    window.__firebaseApp = firebase.initializeApp(window.__firebaseConfig);
    window.__auth = firebase.auth();
    window.__db = firebase.database();
  </script>
  <script src="js/pipeline.js"></script>
  <script src="js/admin.js"></script>
  <script src="js/portfolio.js"></script>
  <script src="js/contracts.js"></script>
  <script src="js/invoices.js"></script>
  <script src="js/history.js"></script>
  <!-- jsPDF for PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- Chart.js for analytics -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
  <script src="js/analytics.js"></script>
  <script src="js/traffic.js"></script>
  <script>
    /* â•â•â• Mobile Sidebar Toggle â•â•â• */
    function toggleMobileSidebar() {
      const sb = document.getElementById('sidebar');
      const bd = document.getElementById('sidebar-backdrop');
      const isHidden = sb.classList.contains('-translate-x-full');
      sb.classList.toggle('-translate-x-full', !isHidden);
      sb.classList.toggle('translate-x-0', isHidden);
      bd.classList.toggle('hidden', !isHidden);
    }
    /* Auto-close sidebar on mobile when an item is selected */
    ['build-list','leads-panel-content','archived-panel-content',
     'portfolio-sites-list','portfolio-contracts-list','portfolio-invoices-list',
     'history-list'].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.addEventListener('click', () => {
        if (window.innerWidth < 768) toggleMobileSidebar();
      });
    });
  </script>
</body>
</html>
