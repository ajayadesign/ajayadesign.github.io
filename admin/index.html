<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>AjayaDesign ‚Äî Admin Dashboard</title>
  <meta name="robots" content="noindex, nofollow">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            mono: ['JetBrains Mono', 'monospace'],
            sans: ['Inter', 'sans-serif'],
          },
          colors: {
            'surface':     '#06060A',
            'surface-1':   '#0C0C12',
            'surface-2':   '#12121A',
            'surface-3':   '#1A1A24',
            'border':      '#2A2A3A',
            'border-glow': '#3A3A5A',
            'amd-red':     '#ED1C24',
            'brand-btn':   '#991B1B',
            'brand-link':  '#FF6B6B',
            'electric':    '#00D4FF',
            'electric-dim':'#0099BB',
            'neon-green':  '#00FF88',
            'neon-yellow': '#FFD600',
            'neon-orange': '#FF8A00',
            'neon-purple': '#A855F7',
          },
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'glow': 'glow 2s ease-in-out infinite alternate',
            'slide-up': 'slideUp 0.3s ease-out',
            'fade-in': 'fadeIn 0.4s ease-out',
          },
          keyframes: {
            glow: {
              '0%': { boxShadow: '0 0 5px rgba(0,212,255,0.2)' },
              '100%': { boxShadow: '0 0 20px rgba(0,212,255,0.4)' },
            },
            slideUp: {
              '0%': { opacity: '0', transform: 'translateY(10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
          },
        }
      }
    }
  </script>
  <style>
    /* Custom scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: #0C0C12; }
    ::-webkit-scrollbar-thumb { background: #2A2A3A; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #3A3A5A; }

    /* Terminal log styles */
    .log-line { font-size: 0.8rem; line-height: 1.6; }
    .log-line:hover { background: rgba(255,255,255,0.03); }
    .log-step { color: #00D4FF; font-weight: 600; }
    .log-ai { color: #A855F7; }
    .log-test-pass { color: #00FF88; }
    .log-test-fail { color: #FF6B6B; }
    .log-deploy { color: #FFD600; }
    .log-error { color: #FF6B6B; opacity: 0.9; }
    .log-dim { opacity: 0.5; }

    /* Step progress */
    .step-dot { transition: all 0.3s ease; }
    .step-dot.active { box-shadow: 0 0 12px rgba(0,212,255,0.6); }
    .step-dot.done { box-shadow: 0 0 8px rgba(0,255,136,0.4); }
    .step-connector { transition: background 0.5s ease; }

    /* AI chat bubbles */
    .ai-bubble { animation: slideUp 0.3s ease-out; }

    /* Glass effect */
    .glass { background: rgba(12,12,18,0.8); backdrop-filter: blur(12px); }

    /* Sidebar item hover */
    .build-item { transition: all 0.15s ease; }
    .build-item:hover { background: rgba(255,255,255,0.04); }
    .build-item.selected { background: rgba(0,212,255,0.08); border-color: #00D4FF; }

    /* Hide scrollbar for sidebar on mobile */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* Pulsing dot for active builds */
    @keyframes live-pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.5); }
    }
    .live-dot { animation: live-pulse 1.5s ease-in-out infinite; }

    /* ‚ïê‚ïê‚ïê Pipeline Graph Styles ‚ïê‚ïê‚ïê */
    .pipeline-container { position: relative; }

    .pipe-node {
      position: relative;
      padding: 0.75rem 1rem;
      border-radius: 0.75rem;
      border: 1px solid #2A2A3A;
      background: #0C0C12;
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      animation: fadeIn 0.4s ease-out;
    }
    .pipe-node.pending { opacity: 0.3; border-color: #1A1A24; }
    .pipe-node.active {
      border-color: #00D4FF;
      box-shadow: 0 0 20px rgba(0,212,255,0.15), inset 0 0 20px rgba(0,212,255,0.03);
    }
    .pipe-node.done {
      border-color: rgba(0,255,136,0.3);
      background: rgba(0,255,136,0.03);
    }
    .pipe-node.failed {
      border-color: rgba(255,107,107,0.4);
      background: rgba(255,107,107,0.03);
    }
    .pipe-node.stalled {
      border-color: rgba(255,152,0,0.4);
      background: rgba(255,152,0,0.05);
    }

    /* Vertical connector lines */
    .pipe-connector {
      width: 2px;
      margin: 0 auto;
      background: #1A1A24;
      transition: background 0.5s ease;
    }
    .pipe-connector.lit { background: linear-gradient(180deg, rgba(0,255,136,0.5), rgba(0,212,255,0.3)); }
    .pipe-connector.lit-fail { background: linear-gradient(180deg, rgba(255,107,107,0.4), rgba(255,107,107,0.2)); }

    /* Fork/join connectors */
    .pipe-fork {
      position: relative;
      display: flex;
      justify-content: center;
    }
    .pipe-fork::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 2px;
      height: 12px;
      background: inherit;
    }
    .pipe-fork-line {
      position: absolute;
      top: 12px;
      height: 2px;
      background: #1A1A24;
      transition: background 0.5s ease;
    }
    .pipe-fork-line.lit { background: rgba(0,212,255,0.3); }

    /* Branch drop lines */
    .pipe-branch-drop {
      width: 2px;
      height: 12px;
      margin: 0 auto;
      background: #1A1A24;
      transition: background 0.5s ease;
    }
    .pipe-branch-drop.lit { background: rgba(0,212,255,0.3); }

    /* Pulse animation for active nodes */
    @keyframes node-pulse {
      0%, 100% { box-shadow: 0 0 20px rgba(0,212,255,0.15); }
      50% { box-shadow: 0 0 30px rgba(0,212,255,0.3); }
    }
    .pipe-node.active { animation: node-pulse 2s ease-in-out infinite; }

    /* Agent grid cards */
    .agent-card {
      border-radius: 0.5rem;
      border: 1px solid #2A2A3A;
      background: #12121A;
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
      transition: all 0.3s ease;
    }
    .agent-card.pending { opacity: 0.25; }
    .agent-card.active { border-color: #00D4FF; box-shadow: 0 0 12px rgba(0,212,255,0.1); }
    .agent-card.done { border-color: rgba(0,255,136,0.3); }
    .agent-card.failed { border-color: rgba(255,107,107,0.3); }

    /* Council debate bubbles */
    .council-bubble {
      border-radius: 0.75rem;
      padding: 0.6rem 0.8rem;
      font-size: 0.75rem;
      animation: slideUp 0.3s ease-out;
    }
    .council-bubble.strategist { background: rgba(0,212,255,0.08); border-left: 3px solid #00D4FF; }
    .council-bubble.critic { background: rgba(168,85,247,0.08); border-left: 3px solid #A855F7; }

    /* Retry pulse */
    @keyframes retry-shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-2px); }
      40% { transform: translateX(2px); }
      60% { transform: translateX(-1px); }
      80% { transform: translateX(1px); }
    }
    .retry-shake { animation: retry-shake 0.4s ease-in-out; }

    /* Prevent scroll chaining to body on mobile */
    .scroll-contain { overscroll-behavior-y: contain; -webkit-overflow-scrolling: touch; }
    /* Safe area for iPhones with home indicator */
    #mobile-tab-bar { padding-bottom: env(safe-area-inset-bottom, 0); }
    /* Sidebar overlay (mobile only) */
    #sidebar.translate-x-0 { box-shadow: 4px 0 25px rgba(0,0,0,0.6); }
    /* sidebar ends above bottom tab bar on mobile */
    #sidebar { bottom: 3rem; }
    @media (min-width: 768px) {
      #sidebar { bottom: 3rem; box-shadow: none !important; }
    }

    /* ‚ïê‚ïê‚ïê Mobile bottom-sheet drawer for Pipeline/AI/Log ‚ïê‚ïê‚ïê */
    @media (max-width: 767px) {
      /* The drawer is always fixed on mobile once a build is selected */
      #content-wrapper {
        position: fixed !important;
        left: 0; right: 0;
        bottom: calc(3rem + env(safe-area-inset-bottom, 0px));
        z-index: 45;
        background: var(--surface-1, #12121A);
        border-top-left-radius: 1.25rem;
        border-top-right-radius: 1.25rem;
        box-shadow: 0 -4px 20px rgba(0,0,0,0.4);
        display: flex;
        flex-direction: column;
        will-change: transform;
        /* Default: collapsed peek state ‚Äî only tabs visible */
        /* Height is set dynamically by JS; initial = peek height */
        overflow: hidden;
      }
      /* When JS is driving the gesture, no CSS transition (instant follow) */
      #content-wrapper.sheet-dragging {
        transition: none !important;
      }
      /* Animated snap transitions between states */
      #content-wrapper.sheet-animating {
        transition: height 0.35s cubic-bezier(0.16, 1, 0.3, 1);
      }
      /* The drag handle ‚Äî always visible on mobile */
      #content-handle {
        display: flex !important;
        align-items: center;
        justify-content: center;
        padding: 8px 0 4px;
        cursor: grab;
        touch-action: none;
        user-select: none;
        -webkit-user-select: none;
      }
      #content-handle .handle-pill {
        width: 36px;
        height: 4px;
        border-radius: 2px;
        background: rgba(255,255,255,0.25);
        transition: background 0.2s, width 0.2s;
      }
      #content-wrapper.sheet-dragging #content-handle .handle-pill {
        width: 48px;
        background: rgba(0,200,255,0.6);
      }
      /* Glow pulse to attract attention when build loads */
      @keyframes sheetPeekGlow {
        0%, 100% { box-shadow: 0 -4px 20px rgba(0,0,0,0.4); }
        50% { box-shadow: 0 -4px 30px rgba(0,200,255,0.35), 0 -2px 10px rgba(0,200,255,0.15); }
      }
      #content-wrapper.sheet-glow {
        animation: sheetPeekGlow 1.5s ease-in-out 2;
      }
      /* Tabs bar styling in sheet */
      #content-wrapper .sheet-tabs {
        flex-shrink: 0;
      }
      /* Content area fills remaining space & scrolls */
      #content-wrapper .sheet-body {
        flex: 1 1 0;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        overscroll-behavior-y: contain;
        min-height: 0;
      }
      /* State indicator dots */
      #sheet-dots {
        display: flex;
        gap: 5px;
        justify-content: center;
        padding: 0 0 6px;
      }
      #sheet-dots .dot {
        width: 5px; height: 5px;
        border-radius: 50%;
        background: rgba(255,255,255,0.15);
        transition: background 0.3s, transform 0.3s;
      }
      #sheet-dots .dot.active {
        background: rgba(0,200,255,0.8);
        transform: scale(1.4);
      }
      /* Overlay */
      #content-overlay {
        transition: opacity 0.3s;
      }
      #content-overlay.visible {
        opacity: 1;
      }
      #content-overlay.fading {
        opacity: 0;
      }
    }
    /* Desktop: hide sheet-only elements */
    @media (min-width: 768px) {
      #sheet-dots { display: none !important; }
      #content-handle { display: none !important; }
    }

    /* ‚ïê‚ïê‚ïê Outreach Mission Control ‚Äî Sci-Fi Styles ‚ïê‚ïê‚ïê */
    @keyframes mc-scanline {
      0% { top: -4px; }
      100% { top: 100%; }
    }
    @keyframes mc-radar-sweep {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes mc-pulse-ring {
      0% { transform: scale(0.9); opacity: 0.6; }
      50% { transform: scale(1.05); opacity: 1; }
      100% { transform: scale(0.9); opacity: 0.6; }
    }
    @keyframes mc-blink-cursor {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .animate-spin { animation: spin 1s linear infinite; }
    @keyframes mc-glow-border {
      0%, 100% { border-color: rgba(0,212,255,0.15); box-shadow: 0 0 8px rgba(0,212,255,0.05); }
      50% { border-color: rgba(0,212,255,0.45); box-shadow: 0 0 20px rgba(0,212,255,0.15), inset 0 0 15px rgba(0,212,255,0.02); }
    }
    @keyframes mc-glitch {
      0%, 90%, 100% { transform: translate(0); filter: none; }
      92% { transform: translate(-2px, 1px); filter: hue-rotate(90deg); }
      94% { transform: translate(2px, -1px); filter: hue-rotate(-90deg); }
      96% { transform: translate(-1px, -1px); filter: hue-rotate(45deg); }
      98% { transform: translate(1px, 1px); filter: hue-rotate(-45deg); }
    }
    @keyframes mc-text-reveal {
      0% { width: 0; }
      100% { width: 100%; }
    }
    @keyframes mc-data-stream {
      0% { transform: translateY(0); opacity: 1; }
      100% { transform: translateY(-100%); opacity: 0; }
    }
    @keyframes mc-hex-pulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.8; }
    }
    @keyframes mc-orbit {
      0% { transform: rotate(0deg) translateX(28px) rotate(0deg); }
      100% { transform: rotate(360deg) translateX(28px) rotate(-360deg); }
    }

    .mc-panel {
      position: relative;
      border: 1px solid rgba(0,212,255,0.15);
      background: linear-gradient(135deg, #06060A 0%, #0A0A14 100%);
      border-radius: 0.75rem;
      overflow: hidden;
    }
    .mc-panel.mc-active {
      animation: mc-glow-border 3s ease-in-out infinite;
    }
    .mc-panel::before {
      content: '';
      position: absolute;
      top: -4px;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, transparent, rgba(0,212,255,0.4), transparent);
      animation: mc-scanline 4s linear infinite;
      pointer-events: none;
      z-index: 1;
      opacity: 0;
      transition: opacity 0.5s;
    }
    .mc-panel.mc-active::before {
      opacity: 1;
    }

    .mc-header-bar {
      display: flex;
      align-items: center;
      padding: 0.5rem 0.75rem;
      background: rgba(0,212,255,0.03);
      border-bottom: 1px solid rgba(0,212,255,0.1);
      gap: 0.5rem;
    }
    .mc-header-bar .mc-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: #00D4FF;
      animation: live-pulse 1.5s ease-in-out infinite;
    }
    .mc-header-bar .mc-dot.idle { background: #555; animation: none; }
    .mc-header-bar .mc-dot.paused { background: #FFD600; animation: mc-blink-cursor 1s step-end infinite; }
    .mc-header-bar .mc-dot.error { background: #FF6B6B; }

    /* Radar mini-display */
    .mc-radar {
      position: relative;
      width: 80px; height: 80px;
      border-radius: 50%;
      border: 1px solid rgba(0,212,255,0.2);
      background: radial-gradient(circle at center, rgba(0,212,255,0.03) 0%, transparent 70%);
      overflow: hidden;
      flex-shrink: 0;
    }
    .mc-radar .mc-sweep {
      position: absolute;
      top: 50%; left: 50%;
      width: 50%; height: 2px;
      transform-origin: 0 50%;
      background: linear-gradient(90deg, rgba(0,212,255,0.6), transparent);
      animation: mc-radar-sweep 3s linear infinite;
      animation-play-state: paused;
    }
    .mc-radar.mc-active .mc-sweep {
      animation-play-state: running;
    }
    .mc-radar .mc-ring-line {
      position: absolute;
      border-radius: 50%;
      border: 1px solid rgba(0,212,255,0.08);
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
    }
    .mc-radar .mc-blip {
      position: absolute;
      width: 4px; height: 4px;
      border-radius: 50%;
      background: #00FF88;
      box-shadow: 0 0 6px rgba(0,255,136,0.6);
    }

    /* Terminal window */
    .mc-terminal {
      background: #020208;
      border: 1px solid rgba(0,212,255,0.1);
      border-radius: 0.5rem;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.65rem;
      line-height: 1.7;
      overflow: hidden;
      position: relative;
    }
    .mc-terminal-header {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      background: rgba(0,212,255,0.04);
      border-bottom: 1px solid rgba(0,212,255,0.08);
    }
    .mc-terminal-header span { font-size: 0.6rem; color: #555; }
    .mc-terminal-body {
      padding: 8px 10px;
      max-height: 200px;
      overflow-y: auto;
      overflow-x: hidden;
    }
    .mc-terminal-body::-webkit-scrollbar { width: 3px; }
    .mc-terminal-body::-webkit-scrollbar-thumb { background: rgba(0,212,255,0.2); border-radius: 2px; }
    .mc-log-line {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .mc-log-line .mc-ts { color: #333; }
    .mc-log-line .mc-tag-crawl { color: #00D4FF; }
    .mc-log-line .mc-tag-audit { color: #A855F7; }
    .mc-log-line .mc-tag-recon { color: #FFD600; }
    .mc-log-line .mc-tag-email { color: #00FF88; }
    .mc-log-line .mc-tag-score { color: #FF8A00; }
    .mc-log-line .mc-tag-ring { color: #FF6B6B; }
    .mc-log-line .mc-tag-sys { color: #555; }
    .mc-log-line .mc-msg { color: #888; }

    .mc-cursor {
      display: inline-block;
      width: 7px; height: 12px;
      background: #00D4FF;
      animation: mc-blink-cursor 1s step-end infinite;
      vertical-align: middle;
      margin-left: 2px;
    }

    /* Status grid */
    .mc-status-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
    }
    @media (max-width: 640px) {
      .mc-status-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    .mc-stat-card {
      padding: 0.5rem 0.625rem;
      border: 1px solid rgba(0,212,255,0.08);
      border-radius: 0.5rem;
      background: rgba(0,212,255,0.02);
      transition: all 0.3s;
    }
    .mc-stat-card.mc-active {
      border-color: rgba(0,212,255,0.25);
      box-shadow: 0 0 12px rgba(0,212,255,0.06);
    }
    .mc-stat-label {
      font-size: 0.55rem;
      color: #555;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 2px;
    }
    .mc-stat-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1rem;
      font-weight: 700;
      color: #DDD;
    }
    .mc-stat-delta {
      font-size: 0.55rem;
      font-family: 'JetBrains Mono', monospace;
    }

    /* Geo coordinates ticker */
    .mc-coord-ticker {
      overflow: hidden;
      white-space: nowrap;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.6rem;
      color: rgba(0,212,255,0.5);
      padding: 4px 10px;
      border-top: 1px solid rgba(0,212,255,0.06);
      background: rgba(0,0,0,0.3);
    }
    .mc-coord-ticker .mc-ticker-inner {
      display: inline-block;
      animation: mc-ticker-scroll 30s linear infinite;
    }
    @keyframes mc-ticker-scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    /* Agent button enhancements */
    .mc-btn-start {
      position: relative;
      overflow: hidden;
    }
    .mc-btn-start::after {
      content: '';
      position: absolute;
      top: 0; left: -100%;
      width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0,255,136,0.1), transparent);
      transition: left 0.5s;
    }
    .mc-btn-start:hover::after {
      left: 100%;
    }
  </style>
</head>
<body class="bg-surface text-gray-300 font-sans antialiased h-screen overflow-hidden">

  <!-- ‚ïê‚ïê‚ïê Top Bar ‚ïê‚ïê‚ïê -->
  <header class="h-14 bg-surface-1 border-b border-border flex items-center justify-between px-3 md:px-4 z-50 fixed top-0 left-0 right-0">
    <div class="flex items-center gap-2 md:gap-3">
      <button onclick="toggleMobileSidebar()" class="md:hidden text-gray-400 hover:text-white p-1" aria-label="Toggle sidebar">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
      <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-amd-red to-electric flex items-center justify-center">
        <span class="text-white font-mono font-bold text-sm">A</span>
      </div>
      <h1 class="font-mono font-semibold text-white text-sm tracking-wide hidden sm:block">AjayaDesign<span class="text-electric">::</span>Admin</h1>
    </div>
    <div class="flex items-center gap-2 md:gap-4">
      <button onclick="openAddClientModal()" class="flex items-center gap-1.5 px-2 md:px-3 py-1.5 bg-electric/10 text-electric border border-electric/30 rounded-lg font-mono text-xs font-semibold hover:bg-electric/20 transition">
        ‚ûï <span class="hidden sm:inline">Add Client</span>
      </button>
      <div id="connection-status" class="hidden sm:flex items-center gap-2 text-xs font-mono">
        <span class="w-2 h-2 rounded-full bg-gray-600" id="conn-dot"></span>
        <span id="conn-text" class="text-gray-500">Disconnected</span>
      </div>
      <a href="/" class="hidden md:inline text-xs font-mono text-gray-500 hover:text-electric transition">‚Üê Site</a>
      <button onclick="signOut()" class="text-xs font-mono text-gray-500 hover:text-brand-link transition">Sign Out</button>
    </div>
  </header>

  <!-- ‚ïê‚ïê‚ïê Mobile Sidebar Backdrop ‚ïê‚ïê‚ïê -->
  <div id="sidebar-backdrop" class="fixed inset-0 bg-black/60 z-30 hidden md:!hidden" onclick="toggleMobileSidebar()"></div>

  <!-- ‚ïê‚ïê‚ïê Main Layout ‚ïê‚ïê‚ïê -->
  <div class="flex mt-14 h-[calc(100dvh-6.5rem)]">

    <!-- ‚ïê‚ïê‚ïê Sidebar ‚ïê‚ïê‚ïê -->
    <aside id="sidebar" class="fixed top-14 bottom-0 left-0 z-40 w-72 min-w-[18rem] bg-surface-1 border-r border-border flex flex-col -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out">
      <!-- Hidden tab buttons (referenced by switchTab JS ‚Äî IDs still needed) -->
      <div id="desktop-tab-row" class="hidden">
        <button id="tab-builds"></button>
        <button id="tab-leads"><span id="stat-leads">0</span></button>
        <button id="tab-portfolio"></button>
        <button id="tab-history"></button>
        <button id="tab-analytics"></button>
        <button id="tab-traffic"></button>
        <button id="tab-outreach"></button>
      </div>

      <!-- Builds Tab -->
      <div id="builds-tab" class="flex-1 flex flex-col overflow-hidden">
        <!-- Stats -->
        <div class="p-4 border-b border-border">
          <div class="flex items-center justify-between mb-3">
            <h2 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">History</h2>
            <button onclick="refreshBuilds()" class="text-gray-500 hover:text-electric transition" title="Refresh">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
            </button>
          </div>
          <div class="grid grid-cols-3 gap-2">
            <div class="bg-surface-2 rounded-lg p-2 text-center">
              <div id="stat-total" class="font-mono text-lg font-bold text-white">0</div>
              <div class="text-[0.65rem] text-gray-500 uppercase">Total</div>
            </div>
            <div class="bg-surface-2 rounded-lg p-2 text-center">
              <div id="stat-success" class="font-mono text-lg font-bold text-neon-green">0</div>
              <div class="text-[0.65rem] text-gray-500 uppercase">Pass</div>
            </div>
            <div class="bg-surface-2 rounded-lg p-2 text-center">
              <div id="stat-failed" class="font-mono text-lg font-bold text-brand-link">0</div>
              <div class="text-[0.65rem] text-gray-500 uppercase">Fail</div>
            </div>
          </div>
        </div>
        <!-- Build List -->
        <div id="build-list" class="flex-1 overflow-y-auto no-scrollbar p-2 space-y-1">
          <div class="text-center text-gray-600 text-xs font-mono py-8">Loading builds...</div>
        </div>
      </div>

      <!-- Leads Tab (hidden initially) -->
      <div id="leads-panel" class="flex-1 overflow-hidden hidden flex flex-col">
        <div class="p-4 border-b border-border">
          <h2 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">Client Requests</h2>
        </div>
        <!-- Active / Archived sub-tabs -->
        <div class="flex border-b border-border bg-surface-1">
          <button onclick="switchLeadsSubTab('active')" id="leads-subtab-active"
            class="flex-1 py-2 text-[0.65rem] font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-electric text-electric transition">
            Active <span id="stat-leads-active" class="ml-1 px-1.5 py-0.5 rounded-full bg-electric/20 text-electric text-[0.55rem]">0</span>
          </button>
          <button onclick="switchLeadsSubTab('archived')" id="leads-subtab-archived"
            class="flex-1 py-2 text-[0.65rem] font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
            Archived <span id="stat-leads-archived" class="ml-1 px-1.5 py-0.5 rounded-full bg-gray-800 text-gray-500 text-[0.55rem]">0</span>
          </button>
        </div>
        <!-- Active leads list -->
        <div id="leads-panel-content" class="flex-1 overflow-y-auto no-scrollbar p-3 space-y-3">
          <div class="text-center text-gray-600 text-xs font-mono py-8">Loading leads...</div>
        </div>
        <!-- Archived leads list (hidden initially) -->
        <div id="archived-panel-content" class="flex-1 overflow-y-auto no-scrollbar p-3 space-y-3 hidden">
          <div class="text-center text-gray-600 text-xs font-mono py-8">No archived leads</div>
        </div>
      </div>

      <!-- Portfolio Tab (hidden initially) -->
      <div id="portfolio-panel" class="flex-1 overflow-hidden hidden flex flex-col">
        <div class="p-4 border-b border-border">
          <div class="flex items-center justify-between">
            <h2 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">Finished Sites</h2>
            <button onclick="seedPortfolioSites()" class="text-[0.65rem] font-mono px-2 py-1 rounded bg-neon-green/10 text-neon-green hover:bg-neon-green/20 transition" title="Seed existing sites">
              üå± Seed
            </button>
          </div>
        </div>
        <!-- Portfolio sub-tabs -->
        <div class="flex border-b border-border bg-surface-1">
          <button onclick="switchPortfolioSubTab('sites')" id="portfolio-subtab-sites"
            class="flex-1 py-2 text-[0.65rem] font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-electric text-electric transition">
            üåê Sites
          </button>
          <button onclick="switchPortfolioSubTab('contracts')" id="portfolio-subtab-contracts"
            class="flex-1 py-2 text-[0.65rem] font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
            üìù Contracts
          </button>
          <button onclick="switchPortfolioSubTab('invoices')" id="portfolio-subtab-invoices"
            class="flex-1 py-2 text-[0.65rem] font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
            üí∞ Invoices
          </button>
        </div>
        <!-- Sites list -->
        <div id="portfolio-sites-list" class="flex-1 overflow-y-auto no-scrollbar p-3 space-y-3">
          <div class="text-center text-gray-600 text-xs font-mono py-8">Loading portfolio...</div>
        </div>
        <!-- Contracts list (hidden) -->
        <div id="portfolio-contracts-list" class="flex-1 overflow-y-auto no-scrollbar p-3 space-y-3 hidden">
          <div class="text-center text-gray-600 text-xs font-mono py-8">Loading contracts...</div>
        </div>
        <!-- Invoices list (hidden) -->
        <div id="portfolio-invoices-list" class="flex-1 overflow-y-auto no-scrollbar p-3 space-y-3 hidden">
          <div class="text-center text-gray-600 text-xs font-mono py-8">Loading invoices...</div>
        </div>
      </div>

      <!-- History Tab (hidden initially) -->
      <div id="history-panel" class="flex-1 overflow-hidden hidden flex flex-col">
        <div class="p-4 border-b border-border">
          <div class="flex items-center justify-between">
            <h2 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">Activity Trail</h2>
            <button onclick="loadActivityLog()" class="text-gray-500 hover:text-electric transition" title="Refresh">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
            </button>
          </div>
        </div>
        <!-- Filter sub-tabs -->
        <div class="flex border-b border-border bg-surface-1">
          <button onclick="filterActivityLog('all')" id="history-filter-all"
            class="flex-1 py-2 text-[0.65rem] font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-electric text-electric transition">
            All
          </button>
          <button onclick="filterActivityLog('contract')" id="history-filter-contract"
            class="flex-1 py-2 text-[0.65rem] font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
            üìù Contracts
          </button>
          <button onclick="filterActivityLog('invoice')" id="history-filter-invoice"
            class="flex-1 py-2 text-[0.65rem] font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
            üí∞ Invoices
          </button>
        </div>
        <!-- Activity timeline -->
        <div id="history-list" class="flex-1 overflow-y-auto no-scrollbar p-3 space-y-1">
          <div class="text-center text-gray-600 text-xs font-mono py-8">Loading activity...</div>
        </div>
      </div>

      <!-- Analytics Tab (hidden initially) -->
      <div id="analytics-sidebar" class="flex-1 overflow-hidden hidden flex flex-col">
        <div class="p-4 border-b border-border">
          <div class="flex items-center justify-between">
            <h2 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">Insights</h2>
            <button onclick="refreshAnalytics()" class="text-gray-500 hover:text-electric transition" title="Refresh">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
            </button>
          </div>
        </div>
        <!-- Quick KPIs -->
        <div class="p-3 space-y-2 border-b border-border">
          <div class="grid grid-cols-2 gap-2">
            <div class="bg-surface-2 rounded-lg p-2.5 text-center">
              <div id="kpi-revenue" class="font-mono text-lg font-bold text-neon-green">$0</div>
              <div class="text-[0.6rem] text-gray-500 uppercase">Revenue</div>
            </div>
            <div class="bg-surface-2 rounded-lg p-2.5 text-center">
              <div id="kpi-clients" class="font-mono text-lg font-bold text-electric">0</div>
              <div class="text-[0.6rem] text-gray-500 uppercase">Clients</div>
            </div>
            <div class="bg-surface-2 rounded-lg p-2.5 text-center">
              <div id="kpi-contracts" class="font-mono text-lg font-bold text-neon-purple">0</div>
              <div class="text-[0.6rem] text-gray-500 uppercase">Contracts</div>
            </div>
            <div class="bg-surface-2 rounded-lg p-2.5 text-center">
              <div id="kpi-invoices" class="font-mono text-lg font-bold text-neon-yellow">0</div>
              <div class="text-[0.6rem] text-gray-500 uppercase">Invoices</div>
            </div>
          </div>
        </div>
        <!-- Section jump links -->
        <div class="flex-1 overflow-y-auto no-scrollbar p-3 space-y-1">
          <p class="text-[0.6rem] text-gray-600 uppercase tracking-wider font-mono mb-2">Jump to</p>
          <button onclick="scrollAnalytics('sec-revenue')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">üí∞ Revenue & Payments</button>
          <button onclick="scrollAnalytics('sec-pipeline')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">üîÑ Client Pipeline</button>
          <button onclick="scrollAnalytics('sec-engagement')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">üìà Customer Engagement</button>
          <button onclick="scrollAnalytics('sec-builds')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">üî® Build Performance</button>
          <button onclick="scrollAnalytics('sec-storage')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">üíæ Firebase Storage</button>
          <button onclick="scrollAnalytics('sec-activity')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">üìú Activity Timeline</button>
        </div>
      </div>

      <!-- Traffic Tab (hidden initially) -->
      <div id="traffic-sidebar" class="flex-1 overflow-hidden hidden flex flex-col">
        <div class="p-4 border-b border-border">
          <div class="flex items-center justify-between">
            <h2 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">Site Traffic</h2>
            <button onclick="refreshTraffic()" class="text-gray-500 hover:text-electric transition" title="Refresh">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
            </button>
          </div>
        </div>
        <!-- Quick KPIs -->
        <div class="p-3 space-y-2 border-b border-border">
          <div class="grid grid-cols-2 gap-2">
            <div class="bg-surface-2 rounded-lg p-2.5 text-center">
              <div id="traffic-kpi-live" class="font-mono text-lg font-bold text-neon-green">0</div>
              <div class="text-[0.6rem] text-gray-500 uppercase">Live Now</div>
            </div>
            <div class="bg-surface-2 rounded-lg p-2.5 text-center">
              <div id="traffic-kpi-pageviews" class="font-mono text-lg font-bold text-electric">0</div>
              <div class="text-[0.6rem] text-gray-500 uppercase">Views Today</div>
            </div>
            <div class="bg-surface-2 rounded-lg p-2.5 text-center">
              <div id="traffic-kpi-sessions" class="font-mono text-lg font-bold text-neon-purple">0</div>
              <div class="text-[0.6rem] text-gray-500 uppercase">Sessions</div>
            </div>
            <div class="bg-surface-2 rounded-lg p-2.5 text-center">
              <div id="traffic-kpi-avg-duration" class="font-mono text-lg font-bold text-neon-yellow">0s</div>
              <div class="text-[0.6rem] text-gray-500 uppercase">Avg Duration</div>
            </div>
          </div>
        </div>
        <!-- Section jump links -->
        <div class="flex-1 overflow-y-auto no-scrollbar p-3 space-y-1">
          <p class="text-[0.6rem] text-gray-600 uppercase tracking-wider font-mono mb-2">Jump to</p>
          <button onclick="scrollTraffic('sec-live-visitors')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">üëÅÔ∏è Live Visitors</button>
          <button onclick="scrollTraffic('sec-traffic-overview')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">üìà Traffic Overview</button>
          <button onclick="scrollTraffic('sec-top-pages')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">üìÑ Top Pages</button>
          <button onclick="scrollTraffic('sec-traffic-sources')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">üîó Traffic Sources</button>
          <button onclick="scrollTraffic('sec-scroll-depth')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">üìú Scroll Depth</button>
          <button onclick="scrollTraffic('sec-click-heatmap')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">üî• Click Heatmap</button>
          <button onclick="scrollTraffic('sec-performance')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">‚ö° Performance</button>
          <button onclick="scrollTraffic('sec-sessions')" class="w-full text-left px-3 py-2 text-xs font-mono text-gray-400 hover:text-electric hover:bg-surface-2 rounded-lg transition">üóÇÔ∏è Sessions</button>
        </div>
      </div>

      <!-- Outreach Tab (hidden initially) -->
      <div id="outreach-sidebar" class="flex-1 overflow-hidden hidden flex flex-col">
        <div class="p-4 border-b border-border">
          <div class="flex items-center justify-between">
            <h2 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">üéØ Outreach Agent</h2>
            <span id="outreach-alerts-badge" class="hidden px-1.5 py-0.5 bg-red-500 text-white text-[0.6rem] font-bold rounded-full"></span>
          </div>
        </div>
        <!-- Agent Status + Controls -->
        <div class="p-3 border-b border-border">
          <div id="outreach-agent-indicator" class="flex items-center gap-3 mb-3">
            <div class="text-2xl">‚ö™</div>
            <div>
              <div class="text-xs font-mono font-bold uppercase text-gray-500">Not started</div>
              <div id="outreach-agent-task" class="text-[0.6rem] font-mono text-gray-600 truncate max-w-[180px]"></div>
            </div>
          </div>
          <div class="flex gap-2">
            <button onclick="outreachAgentStart()" class="mc-btn-start flex-1 py-1.5 bg-emerald-600/20 text-emerald-400 border border-emerald-600/30 rounded-lg text-xs font-mono hover:bg-emerald-600/30 transition">‚ñ∂ Start</button>
            <button onclick="outreachAgentPause()" class="flex-1 py-1.5 bg-yellow-600/20 text-yellow-400 border border-yellow-600/30 rounded-lg text-xs font-mono hover:bg-yellow-600/30 transition">‚è∏ Pause</button>
            <button onclick="outreachAgentKill()" class="w-10 py-1.5 bg-red-600/20 text-red-400 border border-red-600/30 rounded-lg text-xs font-mono hover:bg-red-600/30 transition" title="Emergency Stop">üõë</button>
          </div>
        </div>
        <!-- Mini Radar -->
        <div class="p-3 border-b border-border flex items-center justify-center">
          <div id="outreach-sidebar-radar" class="mc-radar">
            <div class="mc-sweep"></div>
            <div class="mc-ring-line" style="width:30px;height:30px;"></div>
            <div class="mc-ring-line" style="width:50px;height:50px;"></div>
            <div class="mc-ring-line" style="width:70px;height:70px;"></div>
          </div>
        </div>
        <!-- KPI Cards -->
        <div class="p-3 space-y-1.5 border-b border-border">
          <div id="kpi-prospects" class="flex justify-between text-xs font-mono"><span class="text-gray-500">üìä Prospects</span> <span class="text-gray-200">0</span></div>
          <div id="kpi-audited" class="flex justify-between text-xs font-mono"><span class="text-gray-500">üîç Audited</span> <span class="text-gray-200">0</span></div>
          <div id="kpi-enriched" class="flex justify-between text-xs font-mono"><span class="text-gray-500">üß¨ Enriched</span> <span class="text-gray-200">0</span></div>
          <div id="kpi-contacted" class="flex justify-between text-xs font-mono"><span class="text-gray-500">üìß Contacted</span> <span class="text-gray-200">0</span></div>
          <div id="kpi-replied" class="flex justify-between text-xs font-mono"><span class="text-gray-500">‚≠ê Replied</span> <span class="text-gray-200">0</span></div>
          <div id="kpi-meetings" class="flex justify-between text-xs font-mono"><span class="text-gray-500">üìÖ Meetings</span> <span class="text-gray-200">0</span></div>
        </div>
        <!-- Ring Progress -->
        <div class="p-3 border-b border-border">
          <div class="flex items-center gap-1 mb-2">
            <p class="text-[0.6rem] text-gray-600 uppercase tracking-wider font-mono">Ring Progress</p>
            <span class="text-gray-600 cursor-help relative group" title="Geo-rings expand outward from Manor, TX. Ring 0 = Manor core (5mi), Ring 1 = Pflugerville (10mi), Ring 2 = Round Rock (20mi), etc.">
              ‚ìò
              <span class="absolute hidden group-hover:block bg-gray-900 text-gray-300 text-[0.6rem] font-mono p-2 rounded shadow-lg border border-gray-700 z-50 w-52 left-0 top-4 leading-relaxed">
                <strong class="text-electric">Geo-Ring System</strong><br>
                Concentric rings expanding outward from Manor, TX center (30.34¬∞N, 97.56¬∞W).<br><br>
                Each ring crawls local businesses by category within its radius. Progress shows categories completed vs. total.
              </span>
            </span>
          </div>
          <div id="outreach-ring-progress">
            <div class="text-xs text-gray-500 font-mono">No rings configured</div>
          </div>
        </div>
        <!-- Recent Activity -->
        <div class="flex-1 overflow-y-auto no-scrollbar p-3">
          <p class="text-[0.6rem] text-gray-600 uppercase tracking-wider font-mono mb-2">Recent Activity</p>
          <div id="outreach-activity-feed" class="space-y-0.5">
            <div class="text-xs text-gray-500 font-mono">No activity yet</div>
          </div>
        </div>
      </div>
    </aside>

    <!-- ‚ïê‚ïê‚ïê Main Content ‚ïê‚ïê‚ïê -->
    <main class="flex-1 flex flex-col overflow-hidden md:ml-72">

      <!-- No Build Selected State -->
      <div id="empty-state" class="flex-1 flex items-center justify-center">
        <div class="text-center">
          <div class="text-6xl mb-4 opacity-20">üîß</div>
          <h2 class="font-mono text-xl text-gray-500 mb-2">No build selected</h2>
          <p class="text-sm text-gray-600">Select a build from the sidebar or wait for a new one</p>
        </div>
      </div>

      <!-- Lead Detail (hidden initially) -->
      <div id="lead-detail" class="flex-1 flex flex-col overflow-hidden hidden">

        <!-- Lead Header -->
        <div class="p-3 md:p-6 bg-surface-1 border-b border-border">
          <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
            <div class="flex items-center gap-3">
              <span id="lead-status-badge" class="px-2.5 py-1 rounded-full text-xs font-mono font-semibold"></span>
              <h2 id="lead-business" class="font-mono text-xl font-bold text-white"></h2>
            </div>
            <div class="flex flex-wrap items-center gap-2">
              <select id="lead-status-select" onchange="updateLeadStatusFromDetail(this.value)"
                class="text-xs font-mono px-3 py-1.5 rounded-lg bg-surface-2 border border-border text-gray-300 cursor-pointer focus:border-electric focus:outline-none">
                <option value="new">NEW</option>
                <option value="contacted">CONTACTED</option>
                <option value="building">BUILDING</option>
                <option value="deployed">DEPLOYED</option>
                <option value="archived">ARCHIVED</option>
              </select>
            </div>
          </div>
          <div id="lead-meta" class="flex flex-wrap gap-3 md:gap-6 text-sm text-gray-400"></div>
        </div>

        <!-- Lead Content -->
        <div class="flex-1 overflow-y-auto p-3 md:p-6 pb-20 md:pb-6">
          <!-- Goals Section -->
          <div class="mb-8">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-3">üìã Project Goals</h3>
            <div id="lead-goals" class="bg-surface-2 rounded-xl border border-border p-5 text-sm text-gray-300 leading-relaxed"></div>
          </div>

          <!-- Info Grid -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <div class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1">Email</div>
              <div id="lead-email" class="text-sm text-electric font-mono"></div>
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <div class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1">Niche</div>
              <div id="lead-niche" class="text-sm text-gray-300"></div>
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <div class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1">Submitted</div>
              <div id="lead-time" class="text-sm text-gray-300"></div>
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <div class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1">Source</div>
              <div id="lead-source" class="text-sm text-gray-300 font-mono"></div>
            </div>
          </div>

          <!-- Extended Fields (populated by JS) -->
          <div id="lead-extra-fields" class="mb-8"></div>

          <!-- Actions -->
          <div>
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-3">‚ö° Actions</h3>
            <div class="flex flex-wrap gap-3">
              <button onclick="triggerBuildForLead()" class="inline-flex items-center gap-2 px-5 py-2.5 bg-electric/10 text-electric border border-electric/30 rounded-lg font-mono text-sm font-semibold hover:bg-electric/20 transition">
                üöÄ Trigger Build
              </button>
              <a id="lead-email-link" href="" class="inline-flex items-center gap-2 px-5 py-2.5 bg-surface-2 text-gray-300 border border-border rounded-lg font-mono text-sm hover:border-border-glow transition">
                ‚úâÔ∏è Send Email
              </a>
              <button id="btn-archive-lead" onclick="archiveLead()" class="inline-flex items-center gap-2 px-5 py-2.5 bg-surface-2 text-gray-500 border border-border rounded-lg font-mono text-sm hover:text-brand-link hover:border-brand-link/30 transition">
                üóÉÔ∏è Archive
              </button>
              <button id="btn-restore-lead" onclick="restoreLead()" class="hidden inline-flex items-center gap-2 px-5 py-2.5 bg-neon-green/10 text-neon-green border border-neon-green/30 rounded-lg font-mono text-sm hover:bg-neon-green/20 transition">
                ‚ôªÔ∏è Restore
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Portfolio Site Detail (hidden initially) ‚ïê‚ïê‚ïê -->
      <div id="portfolio-detail" class="flex-1 flex flex-col overflow-hidden hidden">
        <div class="p-3 md:p-6 bg-surface-1 border-b border-border">
          <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
            <div class="flex items-center gap-3">
              <span class="px-2.5 py-1 rounded-full text-xs font-mono font-semibold bg-neon-green/20 text-neon-green">DEPLOYED</span>
              <h2 id="pf-client-name" class="font-mono text-xl font-bold text-white"></h2>
            </div>
            <div class="flex flex-wrap items-center gap-2">
              <button onclick="savePortfolioEdit()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-neon-green/10 text-neon-green border border-neon-green/30 hover:bg-neon-green/20 transition">üíæ Save</button>
              <button onclick="createContractForSite()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-electric/10 text-electric border border-electric/30 hover:bg-electric/20 transition">üìù New Contract</button>
              <button onclick="createInvoiceForSite()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-neon-purple/10 text-neon-purple border border-neon-purple/30 hover:bg-neon-purple/20 transition">üí∞ New Invoice</button>
            </div>
          </div>
          <div id="pf-meta" class="flex flex-wrap gap-3 md:gap-6 text-sm text-gray-400"></div>
        </div>
        <div class="flex-1 overflow-y-auto p-3 md:p-6 pb-20 md:pb-6 space-y-6">
          <!-- Editable Fields Grid -->
          <div>
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-3">üìã Client Details</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Client Name</label>
                <input id="pf-edit-name" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Email</label>
                <input id="pf-edit-email" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Phone</label>
                <input id="pf-edit-phone" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Niche</label>
                <input id="pf-edit-niche" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Location</label>
                <input id="pf-edit-location" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Live URL</label>
                <input id="pf-edit-url" class="w-full bg-transparent border-b border-border text-sm text-electric font-mono focus:border-electric focus:outline-none py-1" />
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Brand Colors</label>
                <input id="pf-edit-colors" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Tagline</label>
                <input id="pf-edit-tagline" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
              </div>
              <div class="md:col-span-2 bg-surface-2 rounded-xl border border-border p-4">
                <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Goals</label>
                <textarea id="pf-edit-goals" rows="3" class="w-full bg-transparent border-b border-border text-sm text-gray-300 font-mono focus:border-electric focus:outline-none py-1 resize-none"></textarea>
              </div>
            </div>
          </div>
          <!-- Site Contracts -->
          <div id="pf-contracts-section">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-3">üìù Contracts</h3>
            <div id="pf-contracts-list" class="space-y-2">
              <p class="text-xs text-gray-600 font-mono">No contracts yet</p>
            </div>
          </div>
          <!-- Site Invoices -->
          <div id="pf-invoices-section">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-3">üí∞ Invoices</h3>
            <div id="pf-invoices-list" class="space-y-2">
              <p class="text-xs text-gray-600 font-mono">No invoices yet</p>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Contract Detail / Builder (hidden initially) ‚ïê‚ïê‚ïê -->
      <div id="contract-detail" class="flex-1 flex flex-col overflow-hidden hidden">
        <div class="p-3 md:p-6 bg-surface-1 border-b border-border">
          <div class="flex flex-wrap items-center justify-between gap-3 mb-2">
            <div class="flex items-center gap-3">
              <span id="ct-status-badge" class="px-2.5 py-1 rounded-full text-xs font-mono font-semibold bg-gray-800 text-gray-400">DRAFT</span>
              <h2 class="font-mono text-lg font-bold text-white">üìù Contract Builder</h2>
            </div>
            <div class="flex flex-wrap items-center gap-2">
              <button onclick="saveContract()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-neon-green/10 text-neon-green border border-neon-green/30 hover:bg-neon-green/20 transition">üíæ Save</button>
              <button onclick="sendContract()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-electric/10 text-electric border border-electric/30 hover:bg-electric/20 transition">üìß Send to Client</button>
              <button onclick="downloadContractPDF()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-neon-purple/10 text-neon-purple border border-neon-purple/30 hover:bg-neon-purple/20 transition">üìÑ Download PDF</button>
              <button onclick="logPastContractEvent()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-neon-yellow/10 text-neon-yellow border border-neon-yellow/30 hover:bg-neon-yellow/20 transition" title="Record a past event (sent via email, payment received, etc.)">üìú Log Event</button>
              <button id="ct-btn-delete" onclick="deleteContract()" class="hidden text-xs font-mono px-3 py-1.5 rounded-lg bg-red-500/10 text-red-400 border border-red-500/30 hover:bg-red-500/20 transition" title="Delete this draft contract">üóëÔ∏è Delete</button>
            </div>
          </div>
          <div id="ct-meta" class="text-xs font-mono text-gray-500"></div>
        </div>
        <div class="flex-1 overflow-y-auto p-3 md:p-6 pb-20 md:pb-6 space-y-6">
          <!-- Signed Contract View (populated by JS when status=signed) -->
          <div id="ct-signed-view" class="hidden"></div>

          <!-- Editable Form (hidden when signed) -->
          <div id="ct-editable-form">
          <!-- Client & Project Info -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Client Name *</label>
              <input id="ct-client-name" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Client Email *</label>
              <input id="ct-client-email" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Client Phone</label>
              <input id="ct-client-phone" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Client Address</label>
              <input id="ct-client-address" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Project Name *</label>
              <input id="ct-project-name" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Total Amount ($)</label>
              <input id="ct-total-amount" type="number" step="0.01" class="w-full bg-transparent border-b border-border text-sm text-neon-green font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Deposit Amount ($)</label>
              <input id="ct-deposit-amount" type="number" step="0.01" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Payment Method</label>
              <select id="ct-payment-method" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1">
                <option value="" class="bg-surface">Select...</option>
                <option value="venmo" class="bg-surface">Venmo</option>
                <option value="zelle" class="bg-surface">Zelle</option>
                <option value="paypal" class="bg-surface">PayPal</option>
                <option value="bank" class="bg-surface">Bank Transfer</option>
              </select>
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Start Date</label>
              <input id="ct-start-date" type="date" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Est. Completion</label>
              <input id="ct-completion-date" type="date" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="md:col-span-2 bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Project Description</label>
              <textarea id="ct-project-desc" rows="3" class="w-full bg-transparent border-b border-border text-sm text-gray-300 font-mono focus:border-electric focus:outline-none py-1 resize-none"></textarea>
            </div>
            <div class="md:col-span-2 bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Payment Terms</label>
              <textarea id="ct-payment-terms" rows="2" class="w-full bg-transparent border-b border-border text-sm text-gray-300 font-mono focus:border-electric focus:outline-none py-1 resize-none"></textarea>
            </div>
          </div>

          <!-- Clauses -->
          <div>
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">üìã Contract Clauses</h3>
              <div class="flex items-center gap-2">
                <button onclick="addCustomClause()" class="text-[0.65rem] font-mono px-2 py-1 rounded bg-electric/10 text-electric hover:bg-electric/20 transition">+ Add Clause</button>
                <button onclick="resetClausesToDefault()" class="text-[0.65rem] font-mono px-2 py-1 rounded bg-surface-2 text-gray-500 hover:text-gray-300 transition">‚Üª Reset Defaults</button>
              </div>
            </div>
            <div id="ct-clauses-container" class="space-y-3">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Custom Notes -->
          <div>
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-3">üìù Custom Notes</h3>
            <textarea id="ct-custom-notes" rows="4" class="w-full bg-surface-2 rounded-xl border border-border p-4 text-sm text-gray-300 font-mono focus:border-electric focus:outline-none resize-none" placeholder="Additional terms or notes..."></textarea>
          </div>

          <!-- Signature Section (read-only, shows after signing) -->
          <div id="ct-signature-section" class="hidden">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-3">‚úçÔ∏è Signature</h3>
            <div class="bg-surface-2 rounded-xl border border-neon-green/30 p-4">
              <div class="flex items-center gap-4">
                <img id="ct-signature-img" src="" class="h-16 border border-border rounded" alt="Client signature" />
                <div>
                  <p id="ct-signer-name" class="font-mono text-sm text-white"></p>
                  <p id="ct-signed-at" class="text-xs text-gray-500 font-mono"></p>
                </div>
              </div>
            </div>
          </div>
          </div><!-- /ct-editable-form -->
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Invoice Detail (hidden initially) ‚ïê‚ïê‚ïê -->
      <div id="invoice-detail" class="flex-1 flex flex-col overflow-hidden hidden">
        <div class="p-3 md:p-6 bg-surface-1 border-b border-border">
          <div class="flex flex-wrap items-center justify-between gap-3 mb-2">
            <div class="flex items-center gap-3">
              <span id="inv-status-badge" class="px-2.5 py-1 rounded-full text-xs font-mono font-semibold bg-gray-800 text-gray-400">DRAFT</span>
              <h2 id="inv-number" class="font-mono text-lg font-bold text-white">üí∞ Invoice</h2>
            </div>
            <div class="flex flex-wrap items-center gap-2">
              <button onclick="saveInvoice()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-neon-green/10 text-neon-green border border-neon-green/30 hover:bg-neon-green/20 transition">üíæ Save</button>
              <button onclick="sendInvoice()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-electric/10 text-electric border border-electric/30 hover:bg-electric/20 transition">üìß Send to Client</button>
              <button onclick="payWithPayPal()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-blue-500/10 text-blue-400 border border-blue-500/30 hover:bg-blue-500/20 transition" title="Generate PayPal.me link (fee passed to client)">üí≥ PayPal Link</button>
              <button onclick="markInvoicePaid()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-neon-green/10 text-neon-green border border-neon-green/30 hover:bg-neon-green/20 transition">‚úÖ Mark Paid</button>
              <button onclick="downloadInvoicePDF()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-neon-purple/10 text-neon-purple border border-neon-purple/30 hover:bg-neon-purple/20 transition">üìÑ Download PDF</button>
              <button onclick="logPastInvoiceEvent()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-neon-yellow/10 text-neon-yellow border border-neon-yellow/30 hover:bg-neon-yellow/20 transition" title="Record a past event (payment received, sent, etc.)">üìú Log Event</button>
            </div>
          </div>
        </div>
        <div class="flex-1 overflow-y-auto p-3 md:p-6 pb-20 md:pb-6 space-y-6">
          <!-- Client Info -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Client Name</label>
              <input id="inv-client-name" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Client Email</label>
              <input id="inv-client-email" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Payment Method</label>
              <select id="inv-payment-method" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1">
                <option value="" class="bg-surface">Select...</option>
                <option value="venmo" class="bg-surface">Venmo</option>
                <option value="zelle" class="bg-surface">Zelle</option>
                <option value="paypal" class="bg-surface">PayPal</option>
                <option value="bank" class="bg-surface">Bank Transfer</option>
              </select>
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <label class="text-[0.65rem] font-mono text-gray-600 uppercase tracking-widest mb-1 block">Due Date</label>
              <input id="inv-due-date" type="date" class="w-full bg-transparent border-b border-border text-sm text-white font-mono focus:border-electric focus:outline-none py-1" />
            </div>
          </div>

          <!-- Line Items -->
          <div>
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">üì¶ Line Items</h3>
              <button onclick="addInvoiceItem()" class="text-[0.65rem] font-mono px-2 py-1 rounded bg-electric/10 text-electric hover:bg-electric/20 transition">+ Add Item</button>
            </div>
            <div id="inv-items-container" class="space-y-2">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Totals -->
          <div class="bg-surface-2 rounded-xl border border-border p-4">
            <div class="grid grid-cols-2 gap-3 text-sm font-mono">
              <div class="text-gray-500">Subtotal</div>
              <div id="inv-subtotal" class="text-right text-white">$0.00</div>
              <div class="text-gray-500">Tax Rate (%)</div>
              <div><input id="inv-tax-rate" type="number" step="0.01" value="0" class="w-full bg-transparent text-right text-white font-mono focus:outline-none" onchange="recalcInvoice()" /></div>
              <div class="text-gray-500">Tax</div>
              <div id="inv-tax-amount" class="text-right text-white">$0.00</div>
              <div class="text-white font-bold text-lg border-t border-border pt-2">Total</div>
              <div id="inv-total" class="text-right text-neon-green font-bold text-lg border-t border-border pt-2">$0.00</div>
            </div>
          </div>

          <!-- Notes -->
          <div>
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-3">üìù Notes</h3>
            <textarea id="inv-notes" rows="3" class="w-full bg-surface-2 rounded-xl border border-border p-4 text-sm text-gray-300 font-mono focus:border-electric focus:outline-none resize-none" placeholder="Payment instructions, thank you note..."></textarea>
          </div>

          <!-- Payment Plan -->
          <div class="bg-surface-2 rounded-xl border border-border p-4">
            <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
              <div class="flex items-center gap-3">
                <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest">üìÖ Payment Plan</h3>
                <label class="flex items-center gap-2 cursor-pointer">
                  <input type="checkbox" id="inv-payment-plan-enabled" onchange="togglePaymentPlan()" class="rounded border-border bg-surface text-electric focus:ring-electric focus:ring-offset-0 w-4 h-4">
                  <span class="text-xs text-gray-500 font-mono">Enable</span>
                </label>
              </div>
              <div id="pp-controls" class="hidden flex flex-wrap items-center gap-2">
                <input type="number" id="pp-num-installments" value="4" min="2" max="36" class="w-16 bg-surface border border-border rounded text-xs text-white font-mono text-center py-1 focus:border-electric focus:outline-none" title="Number of installments" />
                <button onclick="generatePaymentPlan()" class="text-[0.65rem] font-mono px-2 py-1 rounded bg-electric/10 text-electric hover:bg-electric/20 transition">‚ö° Auto-Generate</button>
                <button onclick="addInstallment()" class="text-[0.65rem] font-mono px-2 py-1 rounded bg-neon-green/10 text-neon-green hover:bg-neon-green/20 transition">+ Add</button>
                <button onclick="sendPaymentReminder()" class="text-[0.65rem] font-mono px-2 py-1 rounded bg-neon-yellow/10 text-neon-yellow hover:bg-neon-yellow/20 transition">üîî Send Reminder</button>
              </div>
            </div>
            <div id="pp-summary" class="hidden mb-3">
              <div class="grid grid-cols-3 gap-3 text-center">
                <div class="bg-surface rounded-lg p-2">
                  <div id="pp-paid-count" class="text-neon-green font-mono font-bold text-lg">0</div>
                  <div class="text-[0.6rem] text-gray-600 uppercase">Paid</div>
                </div>
                <div class="bg-surface rounded-lg p-2">
                  <div id="pp-pending-count" class="text-neon-yellow font-mono font-bold text-lg">0</div>
                  <div class="text-[0.6rem] text-gray-600 uppercase">Pending</div>
                </div>
                <div class="bg-surface rounded-lg p-2">
                  <div id="pp-overdue-count" class="text-red-400 font-mono font-bold text-lg">0</div>
                  <div class="text-[0.6rem] text-gray-600 uppercase">Overdue</div>
                </div>
              </div>
            </div>
            <div id="pp-installments" class="hidden space-y-2">
              <!-- Populated by JS -->
            </div>
          </div>

        </div>
      </div>

      <!-- Build Detail (hidden initially) -->
      <div id="build-detail" class="flex-1 flex flex-col overflow-hidden hidden">

        <!-- Build Header -->
        <div id="build-header" class="p-3 md:p-4 bg-surface-1 border-b border-border">
          <div class="flex flex-wrap items-center justify-between gap-2 mb-3">
            <div class="flex items-center gap-3">
              <span id="build-status-badge" class="px-2.5 py-1 rounded-full text-xs font-mono font-semibold"></span>
              <h2 id="build-client" class="font-mono text-lg font-bold text-white"></h2>
              <button id="build-retry-btn" onclick="retryBuild()" class="hidden px-3 py-1 rounded-lg text-xs font-mono font-semibold bg-neon-orange/20 text-neon-orange border border-neon-orange/30 hover:bg-neon-orange/30 transition">üîÑ Retry Build</button>
              <button id="build-protect-btn" onclick="toggleProtection()" class="hidden px-3 py-1 rounded-lg text-xs font-mono font-semibold transition" title="Toggle protection"></button>
              <button id="build-delete-btn" onclick="deleteBuild()" class="hidden px-3 py-1 rounded-lg text-xs font-mono font-semibold bg-red-500/10 text-red-400 border border-red-500/20 hover:bg-red-500/20 transition" title="Delete build">üóëÔ∏è Delete</button>
            </div>
            <div class="flex items-center gap-3 text-xs font-mono text-gray-500">
              <span id="build-id-display"></span>
              <span id="build-time"></span>
            </div>
          </div>
          <div id="build-meta" class="flex flex-wrap gap-2 md:gap-4 text-xs text-gray-400"></div>
        </div>

        <!-- Step Progress Bar -->
        <div id="step-progress" class="px-3 md:px-6 py-4 bg-surface-2 border-b border-border">
          <div class="flex items-center justify-between max-w-3xl mx-auto">
            <!-- Steps rendered by JS -->
          </div>
        </div>

        <!-- Mobile overlay backdrop -->
        <div id="content-overlay" class="hidden fixed inset-0 bg-black/60 z-40 md:hidden" onclick="closeContentPanel()"></div>

        <!-- Content Area: Pipeline / AI / Logs -->
        <div id="content-wrapper" class="flex-1 flex flex-col overflow-hidden md:relative">

          <!-- Mobile drag-handle (touch target for gestures) -->
          <div id="content-handle" class="hidden">
            <div class="handle-pill"></div>
          </div>
          <!-- State indicator dots (peek ¬∑ half ¬∑ full) -->
          <div id="sheet-dots">
            <span class="dot active"></span>
            <span class="dot"></span>
            <span class="dot"></span>
          </div>

          <!-- Content Tabs -->
          <div class="sheet-tabs flex border-b border-border bg-surface-1 overflow-x-auto no-scrollbar">
            <button onclick="switchContentTab('pipeline')" id="ctab-pipeline"
              class="px-5 py-2.5 text-xs font-mono font-semibold uppercase tracking-widest border-b-2 border-electric text-electric transition">
              ‚ö° Pipeline
            </button>
            <button onclick="switchContentTab('ai')" id="ctab-ai"
              class="px-5 py-2.5 text-xs font-mono font-semibold uppercase tracking-widest border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
              ü§ñ AI Activity
            </button>
            <button onclick="switchContentTab('log')" id="ctab-log"
              class="px-5 py-2.5 text-xs font-mono font-semibold uppercase tracking-widest border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
              üìü Log <span id="log-count" class="ml-1 text-gray-600">0</span>
            </button>
            <div class="ml-auto hidden sm:flex items-center gap-2 pr-4">
              <label class="flex items-center gap-1.5 text-xs text-gray-500 cursor-pointer">
                <input type="checkbox" id="auto-scroll" checked class="rounded border-border bg-surface-2 text-electric focus:ring-electric focus:ring-offset-0 w-3.5 h-3.5">
                Auto-scroll
              </label>
            </div>
          </div>

          <!-- Sheet body: scrollable content area -->
          <div class="sheet-body">
            <!-- ‚ïê‚ïê‚ïê Pipeline Graph View ‚ïê‚ïê‚ïê -->
            <div id="content-pipeline" class="flex-1 overflow-y-auto p-3 md:p-6">
              <div id="pipeline-graph" class="pipeline-container max-w-4xl mx-auto">
                <!-- Rendered by JS -->
                <div class="text-center text-gray-600 text-xs font-mono py-12">Waiting for build to start...</div>
              </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê AI Activity Panel (hidden initially) ‚ïê‚ïê‚ïê -->
            <div id="content-ai" class="flex-1 overflow-y-auto p-3 space-y-3 hidden">
              <div id="ai-panel" class="space-y-3">
                <div class="text-center text-gray-600 text-xs font-mono py-8">No AI activity yet</div>
              </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê Build Log Panel (hidden initially) ‚ïê‚ïê‚ïê -->
            <div id="content-log" class="flex-1 overflow-y-auto p-4 font-mono text-xs leading-relaxed hidden">
              <div id="log-panel">
                <div class="text-gray-600">Waiting for build output...</div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Analytics Panel (hidden initially) ‚ïê‚ïê‚ïê -->
      <div id="analytics-panel" class="flex-1 flex flex-col overflow-hidden hidden">
        <!-- Header -->
        <div class="p-3 md:p-6 bg-surface-1 border-b border-border">
          <div class="flex flex-wrap items-center justify-between gap-3">
            <div class="flex items-center gap-3">
              <span class="text-2xl">üìä</span>
              <div>
                <h2 class="font-mono text-xl font-bold text-white">Business Analytics</h2>
                <p id="analytics-updated" class="text-xs text-gray-500 font-mono">Loading...</p>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <select id="analytics-period" onchange="refreshAnalytics()" class="text-xs font-mono px-3 py-1.5 rounded-lg bg-surface-2 border border-border text-gray-300 cursor-pointer focus:border-electric focus:outline-none">
                <option value="7">Last 7 days</option>
                <option value="30" selected>Last 30 days</option>
                <option value="90">Last 90 days</option>
                <option value="365">All time</option>
              </select>
              <button onclick="refreshAnalytics()" class="p-2 rounded-lg bg-surface-2 border border-border text-gray-400 hover:text-electric hover:border-electric transition">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Scrollable content -->
        <div id="analytics-scroll" class="flex-1 overflow-y-auto scroll-contain p-3 md:p-6 space-y-6 pb-20 md:pb-6">

          <!-- ‚ïê‚ïê‚ïê Revenue & Payments ‚ïê‚ïê‚ïê -->
          <section id="sec-revenue">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">üí∞ Revenue &amp; Payments</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-total-revenue" class="font-mono text-xl font-bold text-neon-green">$0</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Total Revenue</div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-collected" class="font-mono text-xl font-bold text-electric">$0</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Collected</div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-outstanding" class="font-mono text-xl font-bold text-neon-yellow">$0</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Outstanding</div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-collection-rate" class="font-mono text-xl font-bold text-neon-purple">0%</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Collection Rate</div>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Revenue Over Time</h4>
                <div class="h-48"><canvas id="chart-revenue"></canvas></div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Payment Status Breakdown</h4>
                <div class="h-48 flex items-center justify-center"><canvas id="chart-payment-status"></canvas></div>
              </div>
            </div>
          </section>

          <!-- ‚ïê‚ïê‚ïê Client Pipeline ‚ïê‚ïê‚ïê -->
          <section id="sec-pipeline">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">üîÑ Client Pipeline</h3>
            <div id="pipeline-funnel" class="space-y-2 mb-4"></div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Lead Sources</h4>
                <div class="h-48 flex items-center justify-center"><canvas id="chart-lead-sources"></canvas></div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Client Niches</h4>
                <div class="h-48 flex items-center justify-center"><canvas id="chart-niches"></canvas></div>
              </div>
            </div>
          </section>

          <!-- ‚ïê‚ïê‚ïê Customer Engagement ‚ïê‚ïê‚ïê -->
          <section id="sec-engagement">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">üìà Customer Engagement</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-avg-deal" class="font-mono text-xl font-bold text-electric">$0</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Avg Deal Size</div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-sign-rate" class="font-mono text-xl font-bold text-neon-green">0%</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Contract Sign Rate</div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-avg-time-sign" class="font-mono text-xl font-bold text-neon-yellow">‚Äî</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Avg Time to Sign</div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-repeat-rate" class="font-mono text-xl font-bold text-neon-purple">0%</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Repeat Client Rate</div>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Contract Status Flow</h4>
                <div class="h-48 flex items-center justify-center"><canvas id="chart-contract-flow"></canvas></div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Monthly Activity</h4>
                <div class="h-48"><canvas id="chart-monthly-activity"></canvas></div>
              </div>
            </div>
            <!-- Top clients table -->
            <div class="bg-surface-2 rounded-xl border border-border p-4 mt-4">
              <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Top Clients by Revenue</h4>
              <div id="top-clients-table" class="overflow-x-auto"></div>
            </div>
          </section>

          <!-- ‚ïê‚ïê‚ïê Build Performance ‚ïê‚ïê‚ïê -->
          <section id="sec-builds">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">üî® Build Performance</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-total-builds" class="font-mono text-xl font-bold text-white">0</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Total Builds</div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-build-success" class="font-mono text-xl font-bold text-neon-green">0%</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Success Rate</div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-avg-build-time" class="font-mono text-xl font-bold text-electric">‚Äî</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Avg Build Time</div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4 text-center">
                <div id="an-sites-live" class="font-mono text-xl font-bold text-neon-yellow">0</div>
                <div class="text-[0.65rem] text-gray-500 uppercase mt-1">Sites Live</div>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Build Outcomes</h4>
                <div class="h-48 flex items-center justify-center"><canvas id="chart-build-outcomes"></canvas></div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Builds Over Time</h4>
                <div class="h-48"><canvas id="chart-builds-timeline"></canvas></div>
              </div>
            </div>
          </section>

          <!-- ‚ïê‚ïê‚ïê Firebase Storage ‚ïê‚ïê‚ïê -->
          <section id="sec-storage">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">üíæ Firebase Realtime DB Storage</h3>
            <div class="bg-surface-2 rounded-xl border border-border p-4 mb-4">
              <!-- Gauge bar -->
              <div class="flex items-center justify-between mb-2">
                <span class="font-mono text-xs text-gray-400">Usage</span>
                <span id="storage-usage-text" class="font-mono text-xs text-electric">Calculating...</span>
              </div>
              <div class="w-full bg-surface rounded-full h-4 overflow-hidden border border-border">
                <div id="storage-bar" class="h-full rounded-full bg-gradient-to-r from-electric to-neon-green transition-all duration-700" style="width:0%"></div>
              </div>
              <div class="flex items-center justify-between mt-1">
                <span class="text-[0.6rem] text-gray-600 font-mono">0 MB</span>
                <span class="text-[0.6rem] text-gray-600 font-mono">1 GB (free tier)</span>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Storage by Node</h4>
                <div class="h-48 flex items-center justify-center"><canvas id="chart-storage"></canvas></div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Node Details</h4>
                <div id="storage-breakdown" class="space-y-2"></div>
              </div>
            </div>
          </section>

          <!-- ‚ïê‚ïê‚ïê Activity Timeline Chart ‚ïê‚ïê‚ïê -->
          <section id="sec-activity">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">üìú Activity Heatmap</h3>
            <div class="bg-surface-2 rounded-xl border border-border p-4 mb-4">
              <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Daily Actions (last 30 days)</h4>
              <div class="h-48"><canvas id="chart-activity-heatmap"></canvas></div>
            </div>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Recent Events</h4>
              <div id="recent-events-list" class="space-y-1 max-h-64 overflow-y-auto overflow-x-auto no-scrollbar"></div>
            </div>
          </section>

        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Traffic Panel ‚ïê‚ïê‚ïê -->
      <div id="traffic-panel" class="flex-1 flex flex-col overflow-hidden hidden">
        <!-- Header -->
        <div class="p-3 md:p-6 bg-surface-1 border-b border-border">
          <div class="flex flex-wrap items-center justify-between gap-3">
            <div class="flex items-center gap-3">
              <span class="text-2xl">üåê</span>
              <div>
                <h2 class="font-mono text-xl font-bold text-white">Site Traffic</h2>
                <p id="traffic-updated" class="text-xs text-gray-500 font-mono">Live data from site_analytics</p>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <button onclick="refreshTraffic()" class="p-2 rounded-lg bg-surface-2 border border-border text-gray-400 hover:text-electric hover:border-electric transition">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Scrollable content -->
        <div id="traffic-scroll" class="flex-1 overflow-y-auto scroll-contain p-3 md:p-6 space-y-6 pb-20 md:pb-6">

          <!-- ‚ïê‚ïê‚ïê Live Visitors ‚ïê‚ïê‚ïê -->
          <section id="sec-live-visitors">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">üëÅÔ∏è Live Visitors</h3>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <div class="flex items-center gap-2 mb-3">
                <span class="w-2.5 h-2.5 bg-neon-green rounded-full animate-pulse"></span>
                <span id="traffic-live-count" class="font-mono text-sm text-neon-green font-bold">0</span>
                <span class="text-xs text-gray-500 font-mono">visitors online now</span>
              </div>
              <!-- Header row -->
              <div class="flex items-center justify-between py-1.5 px-2 text-[0.6rem] text-gray-600 font-mono uppercase tracking-wider border-b border-border mb-1">
                <span class="w-24">Visitor</span>
                <span class="flex-1">Page</span>
                <span class="w-16">Device</span>
                <span class="w-16 text-right">Time on</span>
              </div>
              <div id="traffic-live-table" class="overflow-x-auto">
                <p class="text-gray-500 text-xs font-mono text-center py-6">Waiting for visitors‚Ä¶</p>
              </div>
            </div>
          </section>

          <!-- ‚ïê‚ïê‚ïê Traffic Overview (30-day chart) ‚ïê‚ïê‚ïê -->
          <section id="sec-traffic-overview">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">üìà Traffic Overview (30 days)</h3>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <div class="h-56"><canvas id="traffic-chart-overview"></canvas></div>
            </div>
          </section>

          <!-- ‚ïê‚ïê‚ïê Top Pages & Referrers ‚ïê‚ïê‚ïê -->
          <section id="sec-top-pages">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">üìÑ Top Pages & Referrers</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Most Visited Pages</h4>
                <div id="traffic-top-pages">
                  <p class="text-gray-500 text-xs font-mono py-4">Loading‚Ä¶</p>
                </div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Top Referrers</h4>
                <div id="traffic-top-referrers">
                  <p class="text-gray-500 text-xs font-mono py-4">Loading‚Ä¶</p>
                </div>
              </div>
            </div>
          </section>

          <!-- ‚ïê‚ïê‚ïê Traffic Sources & Devices ‚ïê‚ïê‚ïê -->
          <section id="sec-traffic-sources">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">üîó Traffic Sources & Devices</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Source Breakdown</h4>
                <div class="h-48 flex items-center justify-center"><canvas id="traffic-chart-sources"></canvas></div>
              </div>
              <div class="bg-surface-2 rounded-xl border border-border p-4">
                <h4 class="font-mono text-[0.65rem] text-gray-500 uppercase tracking-wider mb-3">Device Breakdown</h4>
                <div class="h-48 flex items-center justify-center"><canvas id="traffic-chart-devices"></canvas></div>
              </div>
            </div>
          </section>

          <!-- ‚ïê‚ïê‚ïê Scroll Depth ‚ïê‚ïê‚ïê -->
          <section id="sec-scroll-depth">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">üìú Scroll Depth</h3>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <div class="h-48"><canvas id="traffic-chart-scroll"></canvas></div>
            </div>
          </section>

          <!-- ‚ïê‚ïê‚ïê Click Heatmap ‚ïê‚ïê‚ïê -->
          <section id="sec-click-heatmap">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">üî• Click Heatmap</h3>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <div class="flex items-center gap-3 mb-4">
                <select id="traffic-heatmap-page" onchange="loadTrafficHeatmap()"
                  class="text-xs font-mono px-3 py-1.5 rounded-lg bg-surface border border-border text-gray-300 cursor-pointer focus:border-electric focus:outline-none">
                  <option value="">Select page‚Ä¶</option>
                </select>
              </div>
              <div class="h-64"><canvas id="traffic-chart-clicks"></canvas></div>
            </div>
          </section>

          <!-- ‚ïê‚ïê‚ïê Performance ‚ïê‚ïê‚ïê -->
          <section id="sec-performance">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">‚ö° Performance Metrics</h3>
            <div id="traffic-perf-grid" class="grid grid-cols-2 md:grid-cols-5 gap-3">
              <p class="text-gray-500 text-xs font-mono text-center py-6 col-span-full">Loading‚Ä¶</p>
            </div>
          </section>

          <!-- ‚ïê‚ïê‚ïê Sessions ‚ïê‚ïê‚ïê -->
          <section id="sec-sessions">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-widest mb-4">üóÇÔ∏è Recent Sessions</h3>
            <div class="bg-surface-2 rounded-xl border border-border p-4">
              <!-- Header row -->
              <div class="flex items-center gap-2 py-1.5 px-2 text-[0.6rem] text-gray-600 font-mono uppercase tracking-wider border-b border-border mb-1 min-w-0">
                <span class="w-16 shrink-0">Visitor</span>
                <span class="w-14 shrink-0 hidden sm:block">Device</span>
                <span class="w-10 shrink-0">Pages</span>
                <span class="w-14 shrink-0">Duration</span>
                <span class="w-14 shrink-0 hidden sm:block">Source</span>
                <span class="flex-1 text-right">When</span>
              </div>
              <div id="traffic-sessions-list" class="overflow-x-auto">
                <p class="text-gray-500 text-xs font-mono text-center py-6">Loading‚Ä¶</p>
              </div>
            </div>
          </section>

        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê Outreach Panel ‚ïê‚ïê‚ïê -->
      <div id="outreach-panel" class="hidden flex-1 overflow-y-auto p-3 md:p-6 space-y-4 md:space-y-6">
        <!-- Mode Banner -->
        <div id="outreach-mode-banner" class="hidden px-4 py-2 text-xs font-mono rounded-lg mb-2"></div>

        <!-- ‚ïê‚ïê‚ïê MISSION CONTROL ‚Äî Sci-Fi Hero ‚ïê‚ïê‚ïê -->
        <div id="mc-hero" class="mc-panel">
          <!-- Header bar -->
          <div class="mc-header-bar">
            <div id="mc-status-dot" class="mc-dot idle"></div>
            <span class="font-mono text-[0.65rem] text-gray-400 tracking-wider uppercase flex-1">Mission Control</span>
            <span id="mc-uptime" class="font-mono text-[0.6rem] text-gray-600">00:00:00</span>
            <span id="mc-heartbeat" class="text-[0.55rem] text-gray-700 font-mono">‚ô°</span>
          </div>

          <!-- Main mission visual -->
          <div class="p-3 md:p-4">
            <div class="flex flex-col md:flex-row gap-3 md:gap-4">

              <!-- Left: Radar + Status -->
              <div class="flex flex-row md:flex-col items-center gap-3 md:gap-2">
                <div id="mc-radar" class="mc-radar" style="width:100px;height:100px;">
                  <div class="mc-sweep"></div>
                  <div class="mc-ring-line" style="width:36px;height:36px;"></div>
                  <div class="mc-ring-line" style="width:62px;height:62px;"></div>
                  <div class="mc-ring-line" style="width:88px;height:88px;"></div>
                  <div id="mc-blips"></div>
                </div>
                <div class="text-center flex-1 md:flex-none">
                  <div id="mc-status-text" class="font-mono text-xs text-gray-500 uppercase tracking-widest">Standby</div>
                  <div id="mc-current-task" class="font-mono text-[0.6rem] text-electric/60 mt-0.5 truncate max-w-[160px] md:max-w-[120px]"></div>
                </div>
              </div>

              <!-- Center: Live Terminal -->
              <div class="flex-1 min-w-0">
                <div class="mc-terminal">
                  <div class="mc-terminal-header">
                    <div style="width:6px;height:6px;border-radius:50%;background:#FF5F56;"></div>
                    <div style="width:6px;height:6px;border-radius:50%;background:#FFBD2E;"></div>
                    <div style="width:6px;height:6px;border-radius:50%;background:#27C93F;"></div>
                    <span class="ml-2">outreach-agent ‚Äî v1.0</span>
                  </div>
                  <div id="mc-terminal-body" class="mc-terminal-body">
                    <div class="mc-log-line"><span class="mc-ts">--:--:--</span> <span class="mc-tag-sys">[SYS]</span> <span class="mc-msg">Awaiting launch sequence‚Ä¶</span><span class="mc-cursor"></span></div>
                  </div>
                </div>
              </div>

              <!-- Right: Quick stats column (hidden on very small screens) -->
              <div class="hidden sm:flex flex-col gap-1.5 min-w-[110px]">
                <div class="mc-stat-card">
                  <div class="mc-stat-label">Scanned</div>
                  <div id="mc-stat-scanned" class="mc-stat-value text-sm">0</div>
                </div>
                <div class="mc-stat-card">
                  <div class="mc-stat-label">Qualified</div>
                  <div id="mc-stat-qualified" class="mc-stat-value text-sm text-emerald-400">0</div>
                </div>
                <div class="mc-stat-card">
                  <div class="mc-stat-label">Contacted</div>
                  <div id="mc-stat-contacted" class="mc-stat-value text-sm text-electric">0</div>
                </div>
                <div class="mc-stat-card">
                  <div class="mc-stat-label">Replies</div>
                  <div id="mc-stat-replies" class="mc-stat-value text-sm text-neon-green">0</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Bottom ticker: scanning coordinates -->
          <div id="mc-coord-ticker" class="mc-coord-ticker">
            <div class="mc-ticker-inner">
              <span>// STANDBY ‚Äî Launch agent to begin geo-scanning //</span>
            </div>
          </div>
        </div>

        <!-- KPI Row (mobile-friendly, visible always) -->
        <div class="mc-status-grid sm:hidden">
          <div class="mc-stat-card"><div class="mc-stat-label">Scanned</div><div id="mc-stat-scanned-m" class="mc-stat-value text-sm">0</div></div>
          <div class="mc-stat-card"><div class="mc-stat-label">Qualified</div><div id="mc-stat-qualified-m" class="mc-stat-value text-sm text-emerald-400">0</div></div>
          <div class="mc-stat-card"><div class="mc-stat-label">Contacts</div><div id="mc-stat-contacted-m" class="mc-stat-value text-sm text-electric">0</div></div>
          <div class="mc-stat-card"><div class="mc-stat-label">Replies</div><div id="mc-stat-replies-m" class="mc-stat-value text-sm text-neon-green">0</div></div>
        </div>

        <!-- Full Mode: Prospect Table -->
        <div class="outreach-full-only" style="display: none;">
          <div class="bg-surface-1 rounded-xl border border-border p-4">
            <!-- Toolbar: filters + search -->
            <div class="flex flex-wrap items-center gap-2 mb-4">
              <h3 class="font-mono text-sm font-semibold text-gray-300 uppercase tracking-wide mr-auto">
                Prospects <span id="outreach-prospects-count" class="text-gray-500 text-xs font-normal ml-1">(0)</span>
              </h3>
              <input id="outreach-search" type="text" placeholder="Search..." onkeyup="outreachSearchProspects()" class="px-3 py-1.5 bg-surface-2 border border-border rounded-lg text-xs font-mono text-gray-300 placeholder-gray-600 focus:outline-none focus:border-electric/50 w-36">
              <select id="outreach-filter-status" onchange="outreachSearchProspects()" class="px-2 py-1.5 bg-surface-2 border border-border rounded-lg text-xs font-mono text-gray-400 focus:outline-none focus:border-electric/50">
                <option value="">All Status</option>
                <option value="discovered">Discovered</option>
                <option value="audited">Audited</option>
                <option value="enriched">Enriched</option>
                <option value="contacted">Contacted</option>
                <option value="replied">Replied</option>
                <option value="meeting_booked">Meeting</option>
                <option value="promoted">Promoted</option>
              </select>
              <select id="outreach-filter-type" onchange="outreachSearchProspects()" class="px-2 py-1.5 bg-surface-2 border border-border rounded-lg text-xs font-mono text-gray-400 focus:outline-none focus:border-electric/50">
                <option value="">All Types</option>
              </select>
              <button id="outreach-filter-nosite" onclick="outreachToggleNoWebsite()" class="px-3 py-1.5 bg-surface-2 border border-border rounded-lg text-xs font-mono text-gray-400 hover:border-red-500/50 hover:text-red-400 transition" title="Show businesses WITHOUT a website ‚Äî your top prospects!">üö´üåê No Website</button>
              <select id="outreach-page-size" onchange="outreachSearchProspects()" class="px-2 py-1.5 bg-surface-2 border border-border rounded-lg text-xs font-mono text-gray-400 focus:outline-none focus:border-electric/50">
                <option value="25">25/page</option>
                <option value="50">50/page</option>
                <option value="100">100/page</option>
              </select>
            </div>

            <!-- Pipeline Worker Status -->
            <div id="outreach-pipeline-bar" class="flex items-center gap-3 mb-3 px-3 py-2 bg-surface-2 rounded-lg border border-border">
              <div class="flex items-center gap-2">
                <span id="outreach-pipeline-dot" class="w-2 h-2 rounded-full bg-gray-600"></span>
                <span class="text-[0.65rem] font-mono text-gray-400">Pipeline Worker</span>
                <span id="outreach-pipeline-status" class="text-[0.65rem] font-mono text-gray-500">‚Äî</span>
              </div>
              <div class="flex-1"></div>
              <div class="flex items-center gap-1 text-[0.6rem] font-mono text-gray-600">
                <span class="text-gray-500">DB:</span>
                <span id="outreach-pw-db-total" class="text-gray-300 font-semibold">0</span> prospects ¬∑
                <span id="outreach-pw-db-audited" class="text-emerald-400/70">0</span> audited ¬∑
                <span id="outreach-pw-db-enriched" class="text-blue-400/70">0</span> enriched ¬∑
                <span id="outreach-pw-db-queued" class="text-purple-400/70">0</span> queued
                <span class="text-gray-700 mx-1">|</span>
                <span class="text-gray-500" title="Processing totals this session">Session:</span>
                <span title="Total crawl cycles completed ‚Äî each discovers new businesses"><span id="outreach-pw-crawls">0</span> crawl</span> ¬∑
                <span title="Total website audits completed"><span id="outreach-pw-audits">0</span> audit</span> ¬∑
                <span title="Total recon lookups (email/owner discovery)"><span id="outreach-pw-recons">0</span> recon</span> ¬∑
                <span title="Total emails composed and queued for approval"><span id="outreach-pw-enqueues">0</span> enqueue</span>
              </div>
              <button onclick="outreachTogglePipeline()" id="outreach-pipeline-toggle" class="px-2 py-0.5 bg-emerald-600/20 text-emerald-400 border border-emerald-600/30 rounded text-[0.6rem] font-mono hover:bg-emerald-600/30 transition">Start</button>
              <select id="outreach-agent-count" onchange="outreachScaleAgents(this.value)" class="bg-surface-2 border border-border text-gray-400 text-[0.6rem] font-mono rounded px-1 py-0.5 cursor-pointer" title="Number of concurrent agents">
                <option value="1">1 agent</option>
                <option value="2">2 agents</option>
                <option value="3">3 agents</option>
                <option value="5">5 agents</option>
              </select>
              <button onclick="outreachRecoverAll()" class="px-2 py-0.5 bg-amber-600/20 text-amber-400 border border-amber-600/30 rounded text-[0.6rem] font-mono hover:bg-amber-600/30 transition" title="Fix any stuck/bad states">üîß Recover</button>
            </div>

            <!-- Bulk Action Toolbar (hidden until selection) -->
            <div id="outreach-bulk-toolbar" class="hidden flex items-center gap-2 mb-3 px-3 py-2 bg-electric/5 rounded-lg border border-electric/20">
              <span id="outreach-selected-count" class="text-xs font-mono text-electric">0 selected</span>
              <div class="flex-1"></div>
              <button onclick="outreachBulkAction('advance')" class="px-3 py-1 bg-electric/20 text-electric border border-electric/30 rounded text-[0.65rem] font-mono hover:bg-electric/30 transition">‚ö° Auto-Advance</button>
              <button onclick="outreachBulkAction('audit')" class="px-3 py-1 bg-amber-600/20 text-amber-400 border border-amber-600/30 rounded text-[0.65rem] font-mono hover:bg-amber-600/30 transition">üîç Audit</button>
              <button onclick="outreachBulkAction('recon')" class="px-3 py-1 bg-blue-600/20 text-blue-400 border border-blue-600/30 rounded text-[0.65rem] font-mono hover:bg-blue-600/30 transition">üïµÔ∏è Recon</button>
              <button onclick="outreachBulkAction('enqueue')" class="px-3 py-1 bg-emerald-600/20 text-emerald-400 border border-emerald-600/30 rounded text-[0.65rem] font-mono hover:bg-emerald-600/30 transition">üìß Generate Emails</button>
              <button onclick="outreachClearSelection()" class="px-3 py-1 bg-gray-700/30 text-gray-400 border border-gray-700/40 rounded text-[0.65rem] font-mono hover:bg-gray-700/50 transition">‚úï Clear</button>
            </div>

            <!-- Table -->
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead>
                  <tr class="border-b border-border">
                    <th class="px-2 py-2 w-8"><input type="checkbox" id="outreach-select-all" onchange="outreachToggleSelectAll()" class="accent-electric cursor-pointer" /></th>
                    <th class="text-left px-3 py-2 text-xs font-mono text-gray-500 uppercase cursor-pointer hover:text-electric select-none" onclick="outreachSort('business_name')">Business <span id="sort-arrow-business_name" class="text-[0.5rem]"></span></th>
                    <th class="text-left px-3 py-2 text-xs font-mono text-gray-500 uppercase cursor-pointer hover:text-electric select-none" onclick="outreachSort('business_type')">Type <span id="sort-arrow-business_type" class="text-[0.5rem]"></span></th>
                    <th class="text-left px-3 py-2 text-xs font-mono text-gray-500 uppercase cursor-pointer hover:text-electric select-none" onclick="outreachSort('status')">Status <span id="sort-arrow-status" class="text-[0.5rem]"></span></th>
                    <th class="text-center px-3 py-2 text-xs font-mono text-gray-500 uppercase cursor-pointer hover:text-electric select-none" onclick="outreachSort('priority_score')">Score <span id="sort-arrow-priority_score" class="text-[0.5rem]"></span></th>
                    <th class="text-center px-3 py-2 text-xs font-mono text-gray-500 uppercase cursor-pointer hover:text-electric select-none" onclick="outreachSort('has_website')">üåê <span id="sort-arrow-has_website" class="text-[0.5rem]"></span></th>
                    <th class="text-left px-3 py-2 text-xs font-mono text-gray-500 uppercase cursor-pointer hover:text-electric select-none" onclick="outreachSort('city')">City <span id="sort-arrow-city" class="text-[0.5rem]"></span></th>
                    <th class="text-left px-3 py-2 text-xs font-mono text-gray-500 uppercase cursor-pointer hover:text-electric select-none" onclick="outreachSort('google_rating')">Rating <span id="sort-arrow-google_rating" class="text-[0.5rem]"></span></th>
                    <th class="text-left px-3 py-2 text-xs font-mono text-gray-500 uppercase cursor-pointer hover:text-electric select-none" onclick="outreachSort('created_at')">Found <span id="sort-arrow-created_at" class="text-[0.5rem]"></span></th>
                  </tr>
                </thead>
                <tbody id="outreach-prospects-tbody">
                  <tr><td colspan="9" class="text-center text-gray-500 py-8 font-mono text-sm">Start the agent to begin discovery.</td></tr>
                </tbody>
              </table>
            </div>
            <!-- Pagination -->
            <div class="flex items-center justify-between mt-3 pt-3 border-t border-border">
              <div id="outreach-page-info" class="text-xs text-gray-500 font-mono">Page 1</div>
              <div class="flex gap-2">
                <button id="outreach-prev-page" onclick="outreachPrevPage()" disabled class="px-3 py-1 bg-surface-2 border border-border rounded text-xs font-mono text-gray-500 disabled:opacity-30 hover:border-electric/50 transition">‚Üê Prev</button>
                <button id="outreach-next-page" onclick="outreachNextPage()" disabled class="px-3 py-1 bg-surface-2 border border-border rounded text-xs font-mono text-gray-500 disabled:opacity-30 hover:border-electric/50 transition">Next ‚Üí</button>
              </div>
            </div>
          </div>
        </div>

        <!-- ‚ïê‚ïê Prospect Detail Modal (full-screen overlay) ‚ïê‚ïê -->
        <div id="outreach-prospect-modal" class="hidden fixed inset-0 z-50 flex items-start justify-center bg-black/80 backdrop-blur-sm overflow-y-auto pt-8 pb-8">
          <div class="bg-surface-1 rounded-2xl border border-border w-full max-w-3xl shadow-2xl mx-4 relative">
            <!-- Close button -->
            <button onclick="outreachCloseProspect()" class="absolute top-3 right-3 z-10 w-8 h-8 flex items-center justify-center bg-gray-800/60 hover:bg-gray-700 text-gray-400 hover:text-white rounded-full transition text-lg">&times;</button>
            <!-- Modal body filled by JS -->
            <div id="outreach-prospect-modal-body" class="p-6"></div>
          </div>
        </div>

        <!-- Full Mode: Email Approval Queue -->
        <div id="outreach-email-queue" class="outreach-full-only mt-4" style="display: none;">
          <div class="bg-surface-1 rounded-xl border border-border p-4">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-mono text-sm font-semibold text-gray-300 uppercase tracking-wide">
                üìß Email Approval Queue <span id="outreach-pending-count" class="px-2 py-0.5 bg-amber-500/20 text-amber-400 text-[0.65rem] font-bold rounded-full ml-2">0</span>
              </h3>
              <div class="flex gap-2 items-center">
                <select id="email-queue-page-size" onchange="outreachEmailQueuePageChange(0)" class="bg-surface-2 border border-border rounded px-2 py-1 text-xs text-gray-300 font-mono cursor-pointer">
                  <option value="10">10/page</option>
                  <option value="25" selected>25/page</option>
                  <option value="100">100/page</option>
                  <option value="500">500/page</option>
                </select>
                <button onclick="outreachRegenAllPending()" class="px-3 py-1.5 bg-amber-600/20 text-amber-400 border border-amber-600/30 rounded-lg text-xs font-mono hover:bg-amber-600/30 transition" title="Re-compose all pending emails with current audit data">üîÑ Regen All</button>
                <button onclick="outreachApproveAll()" class="px-3 py-1.5 bg-emerald-600/20 text-emerald-400 border border-emerald-600/30 rounded-lg text-xs font-mono hover:bg-emerald-600/30 transition">‚úì Approve All</button>
                <button onclick="outreachRefreshPending()" class="px-3 py-1.5 bg-gray-700/50 text-gray-400 rounded-lg text-xs font-mono hover:bg-gray-700 transition">‚Üª Refresh</button>
              </div>
            </div>
            <div id="outreach-pending-emails" class="space-y-3">
              <div class="text-center text-gray-500 py-4 font-mono text-sm">No emails pending approval.</div>
            </div>
            <div id="email-queue-pagination" class="hidden flex items-center justify-between mt-3 pt-3 border-t border-border">
              <div id="email-queue-page-info" class="text-xs text-gray-500 font-mono"></div>
              <div class="flex gap-2">
                <button id="email-queue-prev" onclick="outreachEmailQueuePrev()" class="px-3 py-1 bg-gray-700/50 text-gray-400 rounded text-xs font-mono hover:bg-gray-700 transition disabled:opacity-40 disabled:cursor-not-allowed">‚Üê Prev</button>
                <button id="email-queue-next" onclick="outreachEmailQueueNext()" class="px-3 py-1 bg-gray-700/50 text-gray-400 rounded text-xs font-mono hover:bg-gray-700 transition disabled:opacity-40 disabled:cursor-not-allowed">Next ‚Üí</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Full Mode: Email Tracking Stats -->
        <div id="outreach-email-tracking" class="outreach-full-only mt-4" style="display: none;">
          <div class="bg-surface-1 rounded-xl border border-border p-4">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-mono text-sm font-semibold text-gray-300 uppercase tracking-wide">
                üìà Email Tracking <span id="tracking-total-sent" class="px-2 py-0.5 bg-blue-500/20 text-blue-400 text-[0.65rem] font-bold rounded-full ml-2">0 sent</span>
              </h3>
              <button onclick="outreachRefreshTracking()" class="px-3 py-1.5 bg-gray-700/50 text-gray-400 rounded-lg text-xs font-mono hover:bg-gray-700 transition">‚Üª Refresh</button>
            </div>

            <!-- Delivery Funnel -->
            <div class="grid grid-cols-4 sm:grid-cols-8 gap-2 mb-4">
              <div id="ts-pending" class="bg-surface-2 rounded-lg p-2 text-center border border-border">
                <div class="text-lg font-bold text-amber-400 font-mono">0</div>
                <div class="text-[0.55rem] text-gray-500 uppercase">Pending</div>
              </div>
              <div id="ts-scheduled" class="bg-surface-2 rounded-lg p-2 text-center border border-border">
                <div class="text-lg font-bold text-blue-400 font-mono">0</div>
                <div class="text-[0.55rem] text-gray-500 uppercase">Scheduled</div>
              </div>
              <div id="ts-sent" class="bg-surface-2 rounded-lg p-2 text-center border border-border">
                <div class="text-lg font-bold text-cyan-400 font-mono">0</div>
                <div class="text-[0.55rem] text-gray-500 uppercase">Sent</div>
              </div>
              <div id="ts-opened" class="bg-surface-2 rounded-lg p-2 text-center border border-border">
                <div class="text-lg font-bold text-emerald-400 font-mono">0</div>
                <div class="text-[0.55rem] text-gray-500 uppercase">Opened</div>
              </div>
              <div id="ts-clicked" class="bg-surface-2 rounded-lg p-2 text-center border border-border">
                <div class="text-lg font-bold text-purple-400 font-mono">0</div>
                <div class="text-[0.55rem] text-gray-500 uppercase">Clicked</div>
              </div>
              <div id="ts-replied" class="bg-surface-2 rounded-lg p-2 text-center border border-border">
                <div class="text-lg font-bold text-yellow-400 font-mono">0</div>
                <div class="text-[0.55rem] text-gray-500 uppercase">Replied</div>
              </div>
              <div id="ts-bounced" class="bg-surface-2 rounded-lg p-2 text-center border border-border">
                <div class="text-lg font-bold text-red-400 font-mono">0</div>
                <div class="text-[0.55rem] text-gray-500 uppercase">Bounced</div>
              </div>
              <div id="ts-unsub" class="bg-surface-2 rounded-lg p-2 text-center border border-border">
                <div class="text-lg font-bold text-gray-400 font-mono">0</div>
                <div class="text-[0.55rem] text-gray-500 uppercase">Unsub</div>
              </div>
            </div>

            <!-- Rates Bar -->
            <div id="tracking-rates" class="flex gap-3 mb-4 flex-wrap">
              <div class="flex items-center gap-1.5 text-xs font-mono">
                <div class="w-2 h-2 rounded-full bg-emerald-400"></div>
                <span class="text-gray-400">Open Rate:</span>
                <span id="rate-open" class="text-emerald-400 font-bold">0%</span>
              </div>
              <div class="flex items-center gap-1.5 text-xs font-mono">
                <div class="w-2 h-2 rounded-full bg-purple-400"></div>
                <span class="text-gray-400">Click Rate:</span>
                <span id="rate-click" class="text-purple-400 font-bold">0%</span>
              </div>
              <div class="flex items-center gap-1.5 text-xs font-mono">
                <div class="w-2 h-2 rounded-full bg-yellow-400"></div>
                <span class="text-gray-400">Reply Rate:</span>
                <span id="rate-reply" class="text-yellow-400 font-bold">0%</span>
              </div>
              <div class="flex items-center gap-1.5 text-xs font-mono">
                <div class="w-2 h-2 rounded-full bg-red-400"></div>
                <span class="text-gray-400">Bounce Rate:</span>
                <span id="rate-bounce" class="text-red-400 font-bold">0%</span>
              </div>
            </div>

            <!-- Per-Step Breakdown -->
            <div id="tracking-per-step" class="mb-4">
              <p class="text-[0.6rem] text-gray-600 uppercase tracking-wider font-mono mb-2">Per-Step Breakdown</p>
              <div id="tracking-steps-table" class="text-xs text-gray-400 font-mono">
                No step data yet.
              </div>
            </div>

            <!-- Recent Engagement Feed -->
            <div>
              <p class="text-[0.6rem] text-gray-600 uppercase tracking-wider font-mono mb-2">Recent Engagement</p>
              <div id="tracking-recent" class="space-y-1 max-h-48 overflow-y-auto no-scrollbar">
                <div class="text-xs text-gray-500 font-mono text-center py-3">No engagement yet ‚Äî send some emails first!</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Full Mode: Email Editor Modal (WYSIWYG) -->
        <div id="outreach-email-editor" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm">
          <div class="bg-surface-1 rounded-xl border border-border w-full max-w-4xl max-h-[92vh] overflow-y-auto shadow-2xl">
            <div class="flex items-center justify-between p-4 border-b border-border">
              <h3 class="font-mono text-sm font-semibold text-gray-200">‚úèÔ∏è Edit & Approve Email</h3>
              <div class="flex items-center gap-2">
                <button onclick="outreachRegenEmail()" class="px-2.5 py-1 bg-amber-600/20 text-amber-400 border border-amber-600/30 rounded text-[0.6rem] font-mono hover:bg-amber-600/30 transition" title="Regenerate with current audit data">üîÑ Regen</button>
                <button onclick="outreachCloseEditor()" class="text-gray-500 hover:text-gray-300 text-lg">&times;</button>
              </div>
            </div>
            <div class="p-4 space-y-3">
              <input type="hidden" id="email-editor-id">
              <div class="grid grid-cols-2 gap-3">
                <div>
                  <label class="block text-xs text-gray-500 font-mono mb-1">TO</label>
                  <div id="email-editor-to" class="px-3 py-1.5 bg-surface-2 border border-border rounded-lg text-sm text-gray-300 font-mono"></div>
                </div>
                <div class="grid grid-cols-2 gap-2 text-xs text-gray-500 font-mono">
                  <div class="self-end pb-1">Prospect: <span id="email-editor-prospect" class="text-gray-300"></span></div>
                  <div class="self-end pb-1">Sends: <span id="email-editor-scheduled" class="text-gray-300">after approval</span></div>
                </div>
              </div>
              <div>
                <label class="block text-xs text-gray-500 font-mono mb-1">Subject</label>
                <input id="email-editor-subject" type="text" class="w-full px-3 py-1.5 bg-surface-2 border border-border rounded-lg text-sm text-gray-200 font-mono focus:outline-none focus:border-electric/50">
              </div>
              <!-- Rendered email preview (editable iframe) -->
              <div>
                <div class="flex items-center justify-between mb-1">
                  <label class="text-xs text-gray-500 font-mono">Email Body</label>
                  <div class="flex gap-1">
                    <button id="email-editor-mode-preview" onclick="outreachToggleEditorMode('preview')" class="px-2 py-0.5 bg-electric/20 text-electric border border-electric/30 rounded text-[0.6rem] font-mono">Preview</button>
                    <button id="email-editor-mode-source" onclick="outreachToggleEditorMode('source')" class="px-2 py-0.5 bg-gray-700/50 text-gray-400 border border-gray-700 rounded text-[0.6rem] font-mono">Source</button>
                  </div>
                </div>
                <!-- PREVIEW mode: rendered HTML in iframe -->
                <div id="email-editor-preview-wrap" class="border border-border rounded-lg overflow-hidden bg-white" style="height: 420px;">
                  <iframe id="email-editor-iframe" class="w-full h-full border-0" sandbox="allow-same-origin"></iframe>
                </div>
                <!-- SOURCE mode: raw HTML textarea (hidden by default) -->
                <textarea id="email-editor-body" rows="18" class="hidden w-full px-3 py-2 bg-surface-2 border border-border rounded-lg text-xs text-gray-200 font-mono focus:outline-none focus:border-electric/50 leading-relaxed" style="height: 420px;"></textarea>
              </div>
            </div>
            <div class="flex gap-2 p-4 border-t border-border justify-end">
              <button onclick="outreachSendTestFromEditor()" class="px-4 py-2 bg-amber-600/20 text-amber-400 border border-amber-600/30 rounded-lg text-xs font-mono hover:bg-amber-600/30 transition mr-auto">üìß Send Test to Me</button>
              <button onclick="outreachSaveEmail()" class="px-4 py-2 bg-blue-600/20 text-blue-400 border border-blue-600/30 rounded-lg text-xs font-mono hover:bg-blue-600/30 transition">üíæ Save</button>
              <button onclick="outreachApproveFromEditor()" class="px-4 py-2 bg-emerald-600/20 text-emerald-400 border border-emerald-600/30 rounded-lg text-xs font-mono hover:bg-emerald-600/30 transition">‚úì Approve & Send</button>
              <button onclick="outreachCloseEditor()" class="px-4 py-2 bg-gray-700/50 text-gray-400 rounded-lg text-xs font-mono hover:bg-gray-700 transition">Cancel</button>
            </div>
          </div>
        </div>

        <!-- Light Mode Only: Alerts + Agent Log -->
        <div id="outreach-light-panel" class="space-y-4">
          <!-- Alerts -->
          <div class="bg-surface-1 rounded-xl border border-border p-4">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-wide mb-3">üîî Alerts <span id="outreach-alerts-badge-main" class="hidden px-1.5 py-0.5 bg-red-500 text-white text-[0.6rem] font-bold rounded-full ml-1"></span></h3>
            <div id="outreach-alerts-feed"></div>
          </div>

          <!-- Agent Log (light mode only ‚Äî full mode has MC terminal) -->
          <div class="bg-surface-1 rounded-xl border border-border p-4">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-wide mb-3">Agent Log</h3>
            <div id="outreach-agent-log" class="max-h-48 overflow-y-auto no-scrollbar"></div>
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Analytics Panels (visible in BOTH modes) ‚ïê‚ïê‚ïê -->

        <!-- Funnel + Hot Prospects -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="bg-surface-1 rounded-xl border border-border p-4">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-wide mb-3">Pipeline Funnel</h3>
            <div id="outreach-funnel"></div>
          </div>
          <div class="bg-surface-1 rounded-xl border border-border p-4">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-wide mb-3">üî• Hot Prospects</h3>
            <div id="outreach-hot-prospects"></div>
          </div>
        </div>

        <!-- Sparklines -->
        <div class="bg-surface-1 rounded-xl border border-border p-4">
          <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-wide mb-3">90-Day Trend</h3>
          <div id="outreach-sparklines"></div>
        </div>

        <!-- Scorecard + Templates -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="bg-surface-1 rounded-xl border border-border p-4">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-wide mb-3">Week vs Week</h3>
            <div id="outreach-scorecard"></div>
          </div>
          <div class="bg-surface-1 rounded-xl border border-border p-4">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-wide mb-3">Best Templates</h3>
            <div id="outreach-templates"></div>
          </div>
        </div>

        <!-- Heatmap -->
        <div class="bg-surface-1 rounded-xl border border-border p-4">
          <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-wide mb-3">Best Send Times</h3>
          <div id="outreach-heatmap"></div>
        </div>

        <!-- Industries + Health -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="bg-surface-1 rounded-xl border border-border p-4">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-wide mb-3">Top Industries</h3>
            <div id="outreach-industries"></div>
          </div>
          <div class="bg-surface-1 rounded-xl border border-border p-4">
            <h3 class="font-mono text-xs font-semibold text-gray-400 uppercase tracking-wide mb-3">Agent Health (72h)</h3>
            <div id="outreach-health"></div>
          </div>
        </div>

      </div>

    </main>
  </div>

  <!-- ‚ïê‚ïê‚ïê Login Screen (shown when not authenticated) ‚ïê‚ïê‚ïê -->
  <div id="login-screen" class="fixed inset-0 bg-surface z-[100] flex items-center justify-center">
    <div class="text-center">
      <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-amd-red to-electric flex items-center justify-center mx-auto mb-6">
        <span class="text-white font-mono font-bold text-2xl">A</span>
      </div>
      <h1 class="font-mono text-2xl font-bold text-white mb-2">AjayaDesign<span class="text-electric">::</span>Admin</h1>
      <p class="text-gray-500 text-sm mb-8">Sign in to access the dashboard</p>
      <button id="google-login-btn" class="inline-flex items-center gap-3 px-6 py-3 bg-white text-gray-800 font-semibold rounded-lg hover:bg-gray-100 transition shadow-lg">
        <svg class="w-5 h-5" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 01-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
        Sign in with Google
      </button>
      <p id="login-error" class="text-brand-link text-xs mt-4 hidden"></p>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Add Client Modal ‚ïê‚ïê‚ïê -->
  <div id="add-client-modal" class="fixed inset-0 z-[100] hidden">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/70 backdrop-blur-sm" onclick="closeAddClientModal()"></div>
    <!-- Modal -->
    <div class="absolute inset-4 md:inset-y-8 md:inset-x-auto md:max-w-2xl md:mx-auto bg-surface-1 rounded-2xl border border-border shadow-2xl flex flex-col overflow-hidden animate-slide-up">
      <!-- Header -->
      <div class="flex items-center justify-between p-5 border-b border-border">
        <h2 class="font-mono font-semibold text-white text-sm">‚ûï Add New Client</h2>
        <button onclick="closeAddClientModal()" class="text-gray-500 hover:text-white transition text-xl leading-none">&times;</button>
      </div>

      <!-- Tabs -->
      <div class="flex border-b border-border">
        <button id="acm-tab-manual" onclick="switchAddClientTab('manual')"
          class="flex-1 py-3 text-xs font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-electric text-electric transition">
          Manual Form
        </button>
        <button id="acm-tab-ai" onclick="switchAddClientTab('ai')"
          class="flex-1 py-3 text-xs font-mono font-semibold uppercase tracking-widest text-center border-b-2 border-transparent text-gray-500 hover:text-gray-300 transition">
          AI Paste &amp; Parse
        </button>
      </div>

      <!-- Scrollable Content -->
      <div class="flex-1 overflow-y-auto p-5 space-y-4">

        <!-- ‚îÄ‚îÄ AI Parse Panel ‚îÄ‚îÄ -->
        <div id="acm-ai-panel" class="hidden space-y-4">
          <p class="text-xs text-gray-400 font-mono">Paste client details below ‚Äî email, text message, notes, anything. AI will extract the fields.</p>
          <textarea id="acm-raw-text" rows="6"
            placeholder="Hey Aj, I run a bakery called Sunrise Bakery in Portland OR. We need a website to showcase our artisan breads..."
            class="w-full px-4 py-3 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric focus:ring-1 focus:ring-electric/50 transition-colors resize-none"></textarea>
          <button onclick="parseWithAI()" id="acm-parse-btn"
            class="flex items-center gap-2 px-4 py-2.5 bg-electric/10 text-electric border border-electric/30 rounded-lg font-mono text-xs font-semibold hover:bg-electric/20 transition">
            ü§ñ Parse with AI
          </button>
          <div id="acm-parse-status" class="hidden text-xs font-mono"></div>
        </div>

        <!-- ‚îÄ‚îÄ Form Fields (shared by Manual and AI-parsed) ‚îÄ‚îÄ -->
        <div id="acm-form-fields">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Business Name -->
            <div class="md:col-span-2">
              <label class="block font-mono text-xs text-gray-500 mb-1">Business Name <span class="text-red-400">*</span></label>
              <input id="acm-business-name" type="text" required
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition" placeholder="e.g. Sunrise Bakery" />
            </div>
            <!-- Niche -->
            <div>
              <label class="block font-mono text-xs text-gray-500 mb-1">Niche / Industry <span class="text-red-400">*</span></label>
              <input id="acm-niche" type="text" required
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition" placeholder="e.g. Artisan Bakery" />
            </div>
            <!-- Email -->
            <div>
              <label class="block font-mono text-xs text-gray-500 mb-1">Email <span class="text-red-400">*</span></label>
              <input id="acm-email" type="email" required
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition" placeholder="hello@client.com" />
            </div>
            <!-- Goals -->
            <div class="md:col-span-2">
              <label class="block font-mono text-xs text-gray-500 mb-1">Goals <span class="text-red-400">*</span></label>
              <textarea id="acm-goals" rows="2"
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition resize-none" placeholder="What should the website accomplish?"></textarea>
            </div>
            <!-- Phone -->
            <div>
              <label class="block font-mono text-xs text-gray-500 mb-1">Phone</label>
              <input id="acm-phone" type="tel"
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition" placeholder="(503) 555-1234" />
            </div>
            <!-- Location -->
            <div>
              <label class="block font-mono text-xs text-gray-500 mb-1">Location</label>
              <input id="acm-location" type="text"
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition" placeholder="Portland, OR" />
            </div>
            <!-- Existing Website -->
            <div>
              <label class="block font-mono text-xs text-gray-500 mb-1">Existing Website</label>
              <input id="acm-existing-website" type="url"
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition" placeholder="https://current-site.com" />
            </div>
            <!-- Brand Colors -->
            <div>
              <label class="block font-mono text-xs text-gray-500 mb-1">Brand Colors</label>
              <input id="acm-brand-colors" type="text"
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition" placeholder="Navy blue #1a365d, Gold" />
            </div>
            <!-- Tagline -->
            <div class="md:col-span-2">
              <label class="block font-mono text-xs text-gray-500 mb-1">Tagline / Slogan</label>
              <input id="acm-tagline" type="text"
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition" placeholder="e.g. Fresh Baked Daily Since 1985" />
            </div>
            <!-- Target Audience -->
            <div class="md:col-span-2">
              <label class="block font-mono text-xs text-gray-500 mb-1">Target Audience</label>
              <input id="acm-target-audience" type="text"
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition" placeholder="e.g. Young professionals aged 25-40" />
            </div>
            <!-- Competitor URLs -->
            <div class="md:col-span-2">
              <label class="block font-mono text-xs text-gray-500 mb-1">Competitor URLs</label>
              <textarea id="acm-competitor-urls" rows="2"
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition resize-none" placeholder="One URL per line"></textarea>
            </div>
            <!-- Additional Notes -->
            <div class="md:col-span-2">
              <label class="block font-mono text-xs text-gray-500 mb-1">Additional Notes</label>
              <textarea id="acm-additional-notes" rows="2"
                class="w-full px-3 py-2.5 rounded-lg bg-surface border border-border text-white font-mono text-sm placeholder-gray-600 focus:outline-none focus:border-electric transition resize-none" placeholder="Special hours, certifications, awards..."></textarea>
            </div>
            <!-- Rebuild -->
            <div class="md:col-span-2">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" id="acm-rebuild" class="w-4 h-4 rounded border-border bg-surface text-electric focus:ring-electric/50" />
                <span class="font-mono text-xs text-gray-400">Rebuild existing site</span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer Actions -->
      <div class="p-5 border-t border-border flex items-center justify-between gap-3">
        <button onclick="closeAddClientModal()" class="px-4 py-2.5 text-gray-500 font-mono text-xs hover:text-white transition">Cancel</button>
        <div class="flex gap-3">
          <button onclick="saveNewLead(false)" class="px-4 py-2.5 bg-surface-2 text-gray-300 border border-border rounded-lg font-mono text-xs hover:border-border-glow transition">
            Save Lead Only
          </button>
          <button onclick="saveNewLead(true)" class="px-4 py-2.5 bg-electric/10 text-electric border border-electric/30 rounded-lg font-mono text-xs font-semibold hover:bg-electric/20 transition">
            üöÄ Save &amp; Build
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Mobile Bottom Tab Bar ‚ïê‚ïê‚ïê -->
  <nav id="mobile-tab-bar" class="fixed bottom-0 left-0 right-0 z-50 bg-surface-1 border-t border-border">
    <div class="flex h-12">
      <button onclick="switchTab('builds')" id="mtab-builds"
        class="mobile-tab flex-1 flex flex-col items-center justify-center text-electric transition">
        <span class="text-base leading-none">üî®</span>
        <span class="text-[0.5rem] font-mono font-semibold uppercase tracking-wider mt-0.5">Builds</span>
      </button>
      <button onclick="switchTab('leads')" id="mtab-leads"
        class="mobile-tab flex-1 flex flex-col items-center justify-center text-gray-500 transition">
        <span class="text-base leading-none">üì¨</span>
        <span class="text-[0.5rem] font-mono font-semibold uppercase tracking-wider mt-0.5">Leads</span>
      </button>
      <button onclick="switchTab('portfolio')" id="mtab-portfolio"
        class="mobile-tab flex-1 flex flex-col items-center justify-center text-gray-500 transition">
        <span class="text-base leading-none">üìÅ</span>
        <span class="text-[0.5rem] font-mono font-semibold uppercase tracking-wider mt-0.5">Portfolio</span>
      </button>
      <button onclick="switchTab('history')" id="mtab-history"
        class="mobile-tab flex-1 flex flex-col items-center justify-center text-gray-500 transition">
        <span class="text-base leading-none">üìú</span>
        <span class="text-[0.5rem] font-mono font-semibold uppercase tracking-wider mt-0.5">History</span>
      </button>
      <button onclick="switchTab('analytics')" id="mtab-analytics"
        class="mobile-tab flex-1 flex flex-col items-center justify-center text-gray-500 transition">
        <span class="text-base leading-none">üìä</span>
        <span class="text-[0.5rem] font-mono font-semibold uppercase tracking-wider mt-0.5">Analytics</span>
      </button>
      <button onclick="switchTab('traffic')" id="mtab-traffic"
        class="mobile-tab flex-1 flex flex-col items-center justify-center text-gray-500 transition">
        <span class="text-base leading-none">üåê</span>
        <span class="text-[0.5rem] font-mono font-semibold uppercase tracking-wider mt-0.5">Traffic</span>
      </button>
      <button onclick="switchTab('outreach')" id="mtab-outreach"
        class="mobile-tab flex-1 flex flex-col items-center justify-center text-gray-500 transition">
        <span class="text-base leading-none">üéØ</span>
        <span class="text-[0.5rem] font-mono font-semibold uppercase tracking-wider mt-0.5">Outreach</span>
      </button>
    </div>
  </nav>

  <!-- ‚ïê‚ïê‚ïê Firebase SDK ‚ïê‚ïê‚ïê -->
  <script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-database-compat.js"></script>
  <script src="../js/firebase-config.js"></script>
  <script>
    window.__firebaseApp = firebase.initializeApp(window.__firebaseConfig);
    window.__auth = firebase.auth();
    window.__db = firebase.database();
  </script>
  <script src="js/pipeline.js"></script>
  <script src="js/admin.js"></script>
  <script src="js/portfolio.js"></script>
  <script src="js/contracts.js"></script>
  <script src="js/invoices.js"></script>
  <script src="js/history.js"></script>
  <!-- jsPDF for PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- Chart.js for analytics -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
  <script src="js/analytics.js"></script>
  <script src="js/traffic.js"></script>
  <script src="js/outreach.js"></script>
  <script>
    /* ‚ïê‚ïê‚ïê Mobile Sidebar Toggle ‚ïê‚ïê‚ïê */
    function toggleMobileSidebar() {
      if (window.innerWidth >= 768) return;  // Desktop sidebar is always open
      const sb = document.getElementById('sidebar');
      const bd = document.getElementById('sidebar-backdrop');
      const isHidden = sb.classList.contains('-translate-x-full');
      sb.classList.toggle('-translate-x-full', !isHidden);
      sb.classList.toggle('translate-x-0', isHidden);
      bd.classList.toggle('hidden', !isHidden);
    }
    /* Auto-close sidebar when an item is selected */
    ['build-list','leads-panel-content','archived-panel-content',
     'portfolio-sites-list','portfolio-contracts-list','portfolio-invoices-list',
     'history-list'].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.addEventListener('click', () => {
        if (window.innerWidth < 768) {
          const sb = document.getElementById('sidebar');
          if (sb && sb.classList.contains('translate-x-0')) toggleMobileSidebar();
        }
      });
    });
  </script>
</body>
</html>
